<!doctype html>
<html lang="id" data-theme="cupcake">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Peta Bakat & Sifat Manusia</title>

        <!-- Libraries -->
        <link
            href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css"
            rel="stylesheet"
            type="text/css"
        />
        <script src="https://cdn.tailwindcss.com"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />

        <style>
            body {
                font-family: "Plus Jakarta Sans", sans-serif;
                transition: background-color 0.3s ease;
            }
            .font-arab {
                font-family: "Amiri", serif;
                line-height: 1.6;
            }

            /* Smooth fade */
            .fade-in {
                animation: fadeIn 0.4s ease-out;
            }
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* Map Styles */
            .map-shape {
                cursor: pointer;
                transition: all 0.2s ease;
                vector-effect: non-scaling-stroke;
            }
            .map-shape:hover {
                filter: brightness(0.85);
                stroke: currentColor;
                stroke-width: 2px;
            }
            .map-text {
                fill: #000000 !important;
                font-weight: bold;
                pointer-events: none;
            }

            /* Highlight Animation */
            .map-highlight {
                stroke: #ff0000 !important;
                stroke-width: 8px !important;
                filter: drop-shadow(0 0 8px rgba(255, 0, 0, 0.6));
                animation: pulseMap 1.5s infinite;
                z-index: 50;
            }
            @keyframes pulseMap {
                0% {
                    opacity: 1;
                    stroke-width: 8px;
                }
                50% {
                    opacity: 0.6;
                    stroke-width: 12px;
                }
                100% {
                    opacity: 1;
                    stroke-width: 8px;
                }
            }

            /* Card Animations */
            .hover-scale {
                transition: transform 0.2s;
            }
            .hover-scale:hover {
                transform: translateY(-3px);
            }

            /* Custom Scrollbar for Modal */
            .custom-scroll::-webkit-scrollbar {
                width: 8px;
            }
            .custom-scroll::-webkit-scrollbar-track {
                background: transparent;
            }
            .custom-scroll::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 4px;
            }
        </style>
    </head>
    <body class="bg-base-200 min-h-screen flex flex-col">
        <!-- Navbar -->
        <div class="navbar bg-base-100 shadow-md sticky top-0 z-50">
            <div class="navbar-start">
                <a class="btn btn-ghost text-xl font-bold text-primary gap-2">
                    <i class="fa-solid fa-compass"></i>
                    <span class="hidden sm:inline">Peta Bakat</span>
                </a>
            </div>
            <div class="navbar-center">
                <div role="tablist" class="tabs tabs-boxed bg-base-200">
                    <a
                        role="tab"
                        class="tab tab-active transition-all"
                        id="tab-exploration"
                        onclick="switchView('exploration')"
                    >
                        <i class="fa-solid fa-magnifying-glass mr-2"></i>
                        Eksplorasi
                    </a>
                    <a
                        role="tab"
                        class="tab transition-all"
                        id="tab-table"
                        onclick="switchView('table')"
                    >
                        <i class="fa-solid fa-table mr-2"></i> Tabel
                    </a>
                </div>
            </div>
            <div class="navbar-end gap-2">
                <label
                    class="swap swap-rotate btn btn-ghost btn-circle text-base-content"
                >
                    <input type="checkbox" id="theme-toggle" />
                    <svg
                        class="swap-on fill-current w-6 h-6"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                    >
                        <path
                            d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"
                        />
                    </svg>
                    <svg
                        class="swap-off fill-current w-6 h-6"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                    >
                        <path
                            d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"
                        />
                    </svg>
                </label>
            </div>
        </div>

        <!-- Main Content -->
        <main class="container mx-auto p-4 md:p-6 flex-grow">
            <!-- Header -->
            <div
                class="text-center py-6 bg-base-100 rounded-box shadow-sm mb-6"
            >
                <h1 class="text-3xl font-bold mb-2 text-base-content">
                    Ensiklopedia Karakter
                </h1>
                <p class="text-base-content/70 text-sm max-w-xl mx-auto">
                    Peta interaktif struktur kepribadian manusia berdasarkan
                    jalur Karsa, Cipta, dan Rasa.
                </p>
            </div>

            <!-- Filter & Loading -->
            <div class="mb-6 flex flex-col items-center">
                <div
                    id="loading-indicator"
                    class="flex flex-col items-center gap-4 mb-4"
                >
                    <span
                        class="loading loading-spinner loading-lg text-primary"
                    ></span>
                    <span class="text-sm opacity-60">Mengambil data...</span>
                </div>

                <div id="main-content-wrapper" class="w-full hidden fade-in">
                    <!-- Search Bar -->
                    <div class="form-control w-full max-w-lg mx-auto mb-6">
                        <input
                            type="text"
                            id="global-search"
                            placeholder="Cari sifat, definisi, atau kata kunci..."
                            class="input input-bordered w-full shadow-sm"
                            onkeyup="handleSearch()"
                        />
                    </div>

                    <!-- Filter Buttons -->
                    <div
                        class="flex flex-wrap gap-2 justify-center mb-6"
                        id="category-filters"
                    >
                        <!-- Filters Injected JS -->
                    </div>

                    <!-- VIEW: EKSPLORASI -->
                    <div id="view-exploration" class="view-section">
                        <div
                            class="card bg-base-100 shadow-xl border border-base-200 mb-8"
                        >
                            <div
                                class="bg-base-200 px-4 py-2 border-b border-base-300 flex justify-between items-center rounded-t-xl"
                            >
                                <span class="font-bold text-sm opacity-70"
                                    ><i class="fa-solid fa-map"></i> Peta
                                    Interaktif</span
                                >
                                <span class="text-xs opacity-50"
                                    >Klik area berwarna untuk detail</span
                                >
                            </div>
                            <div class="card-body p-4">
                                <div
                                    class="flex justify-center w-full overflow-x-auto bg-white rounded-box p-4 border relative min-h-[300px]"
                                    id="map-container"
                                >
                                    <!-- SVG Injected via JS -->
                                </div>
                            </div>
                        </div>

                        <div
                            id="content-grid"
                            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"
                        >
                            <!-- Cards Injected JS -->
                        </div>
                    </div>

                    <!-- VIEW: TABEL -->
                    <div id="view-table" class="view-section hidden">
                        <div
                            class="card bg-base-100 shadow-xl overflow-hidden border border-base-200"
                        >
                            <div
                                class="p-4 flex justify-between items-center bg-base-100 border-b"
                            >
                                <h3 class="font-bold text-lg">Data Tabel</h3>
                                <button
                                    class="btn btn-primary btn-sm btn-outline gap-2"
                                    onclick="copyTableData()"
                                >
                                    <i class="fa-regular fa-copy"></i> Salin
                                </button>
                            </div>
                            <div class="overflow-x-auto h-[70vh]">
                                <table
                                    class="table table-pin-rows table-zebra w-full"
                                    id="data-table-el"
                                >
                                    <thead>
                                        <tr
                                            class="bg-base-200 text-base-content"
                                        >
                                            <th>Nama</th>
                                            <th>Arab</th>
                                            <th>Jalur Sifat</th>
                                            <th>Kutub</th>
                                            <th>Definisi Singkat</th>
                                            <th>Kelompok</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table-body">
                                        <!-- Rows Injected JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div
                        id="empty-state"
                        class="hidden text-center py-10 opacity-50"
                    >
                        <i class="fa-regular fa-folder-open text-4xl mb-2"></i>
                        <p>Data tidak ditemukan.</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- DETAIL MODAL (POPUP LENGKAP) -->
        <dialog
            id="detail_modal"
            class="modal modal-bottom sm:modal-middle backdrop-blur-sm"
        >
            <div
                class="modal-box w-11/12 max-w-6xl p-0 bg-base-100 flex flex-col max-h-[90vh] shadow-2xl overflow-hidden"
            >
                <!-- Header -->
                <div
                    class="bg-base-200 border-b border-base-300 p-4 sticky top-0 z-20 flex justify-end"
                >
                    <form method="dialog">
                        <button class="btn btn-sm btn-circle btn-ghost">
                            ✕
                        </button>
                    </form>
                </div>

                <!-- Content Scrollable -->
                <div
                    class="p-6 pt-0 overflow-y-auto custom-scroll"
                    id="modal-content"
                >
                    <!-- Content Injected via JS -->
                </div>
            </div>
            <form method="dialog" class="modal-backdrop">
                <button>close</button>
            </form>
        </dialog>

        <!-- Toast -->
        <div id="toast-container" class="toast toast-end z-50"></div>

        <script>
            // --- GLOBAL STATE ---
            let allItems = [];
            let rawData = {};

            // --- CONFIGURATION ---
            const JSON_URL =
                "https://pub.insantaqwa.org/bakat/calculation.json";

            // --- SVG TEMPLATE (Hardcoded as requested) ---
            const svgMapTemplate = `
        <svg id="main-map-svg" viewBox="0 0 2481 2406" xmlns="http://www.w3.org/2000/svg" class="w-full h-auto max-h-[65vh] mx-auto">
            <rect width="2480.3" height="2405.2" fill="#ffffff" rx="20"/>
            <!-- GROUP 2 -->
            <rect id="map-2-1" x="112.87" y="24.042" width="963.63" height="2308.8" rx="35" fill="#f3f4f6" class="map-shape" fill-opacity="0.2"/>
            <rect id="map-2-2" x="1403.8" y="24.042" width="963.63" height="2308.8" rx="35" fill="#f3f4f6" class="map-shape" fill-opacity="0.2"/>
            <!-- GROUP 3 -->
            <rect id="map-3-1" x="1145.3" y="492.49" width="189.73" height="78.416" ry="20" fill="#ddd" class="map-shape"/>
            <rect id="map-3-2" x="1145.3" y="1273.6" width="189.73" height="78.416" ry="30" fill="#ddd" class="map-shape"/>
            <rect id="map-3-3" x="1145.3" y="2054.7" width="189.73" height="78.416" ry="30" fill="#ddd" class="map-shape"/>
            <!-- GROUP 6 -->
            <rect id="map-6-1" x="840.44" y="492.49" width="189.73" height="78.416" ry="30" fill="#ddd" class="map-shape"/>
            <rect id="map-6-2" x="840.44" y="1273.6" width="189.73" height="78.416" ry="30" fill="#ddd" class="map-shape"/>
            <rect id="map-6-3" x="840.44" y="2054.7" width="189.73" height="78.416" ry="30" fill="#ddd" class="map-shape"/>
            <rect id="map-6-4" x="1450.2" y="492.49" width="189.73" height="78.416" ry="30" fill="#ddd" class="map-shape"/>
            <rect id="map-6-5" x="1450.2" y="1273.6" width="189.73" height="78.416" ry="30" fill="#ddd" class="map-shape"/>
            <rect id="map-6-6" x="1450.2" y="2054.7" width="189.73" height="78.416" ry="30" fill="#ddd" class="map-shape"/>
            <!-- GROUP 18 -->
            <path id="map-18-1" d="m630.45 58.552h29.128a29.128 29.128 0 0129.128 29.128v106.95a29.128 29.128 0 01-29.128 29.128h-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-2" d="m630.45 232.13h29.128a29.128 29.128 0 0129.128 29.128v106.95a29.128 29.128 0 01-29.128 29.128h-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-3" d="m630.45 405.7h29.128a29.128 29.128 0 0129.128 29.128v106.95a29.128 29.128 0 01-29.128 29.128h-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-4" d="m630.45 926.43h29.128a29.128 29.128 0 0129.128 29.128v106.95a29.128 29.128 0 01-29.128 29.128h-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-5" d="m630.45 1100h29.128a29.128 29.128 0 0129.128 29.128v20.16a29.128 29.128 0 01-29.128 29.128h-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-6" d="m630.45 1186.8h29.128a29.128 29.128 0 0129.128 29.128v106.95a29.128 29.128 0 01-29.128 29.128h-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-7" d="m630.45 1707.5h29.128a29.128 29.128 0 0129.128 29.128v20.16a29.128 29.128 0 01-29.128 29.128h-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-8" d="m630.45 1794.3h29.128a29.128 29.128 0 0129.128 29.128v106.95a29.128 29.128 0 01-29.128 29.128h-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-9" d="m630.45 1967.9h29.128a29.128 29.128 0 0129.128 29.128v193.74a29.128 29.128 0 01-29.128 29.128h-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-10" d="m1820.7 58.552h29.128v251.99h-29.128a29.128 29.128 0 01-29.128-29.128v-193.74a29.128 29.128 0 0129.128-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-11" d="m1820.7 318.92h29.128v165.2h-29.128a29.128 29.128 0 01-29.128-29.128v-106.95a29.128 29.128 0 0129.128-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-12" d="m1820.7 492.49h29.128v165.2h-29.132a29.124 29.124 0 01-29.124-29.124v-106.95a29.128 29.128 0 0129.128-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-13" d="m1820.7 752.86h29.123v338.78h-29.128a29.128 29.128 0 01-29.128-29.128v-280.52a29.133 29.133 0 0129.133-29.133z" fill="#ddd" class="map-shape"/>
            <path id="map-18-14" d="m1820.7 1100h29.128v165.2h-29.128a29.128 29.128 0 01-29.128-29.128v-106.95a29.128 29.128 0 0129.128-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-15" d="m1820.7 1273.6h29.128v165.2h-29.132a29.124 29.124 0 01-29.124-29.124v-106.95a29.128 29.128 0 0129.128-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-16" d="m1820.7 1534h29.128v165.2h-29.128a29.128 29.128 0 01-29.128-29.128v-106.95a29.128 29.128 0 0129.128-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-17" d="m1820.7 1707.5h29.128v165.2h-29.128a29.128 29.128 0 01-29.128-29.128v-106.95a29.128 29.128 0 0129.128-29.128z" fill="#ddd" class="map-shape"/>
            <path id="map-18-18" d="m1820.7 1881.1h29.128v338.78h-29.128a29.128 29.128 0 01-29.128-29.128v-280.52a29.128 29.128 0 0129.128-29.128z" fill="#ddd" class="map-shape"/>
            <!-- GROUP 40 -->
            <rect id="map-40-1" x="420.46" y="58.552" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-2" x="420.46" y="145.34" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-3" x="420.46" y="232.13" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-4" x="420.46" y="318.92" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-5" x="420.46" y="405.7" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-6" x="420.46" y="492.49" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-7" x="420.46" y="926.43" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-8" x="420.46" y="1013.2" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-9" x="420.46" y="1100" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-10" x="420.46" y="1186.8" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-11" x="420.46" y="1273.6" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-12" x="420.46" y="1707.5" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-13" x="420.46" y="1794.3" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-14" x="420.46" y="1881.1" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-15" x="420.46" y="1967.9" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-16" x="420.46" y="2054.7" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-17" x="420.46" y="2141.5" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-18" x="1870.1" y="58.552" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-19" x="1870.1" y="145.34" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-20" x="1870.1" y="232.13" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-21" x="1870.1" y="318.92" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-22" x="1870.1" y="405.7" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-23" x="1870.1" y="492.49" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-24" x="1870.1" y="579.28" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-25" x="1870.1" y="752.86" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-26" x="1870.1" y="839.65" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-27" x="1870.1" y="926.43" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-28" x="1870.1" y="1013.2" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-29" x="1870.1" y="1100" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-30" x="1870.1" y="1186.8" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-31" x="1870.1" y="1273.6" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-32" x="1870.1" y="1360.4" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-33" x="1870.1" y="1534" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-34" x="1870.1" y="1620.7" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-35" x="1870.1" y="1707.5" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-36" x="1870.1" y="1794.3" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-37" x="1870.1" y="1881.1" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-38" x="1870.1" y="1967.9" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-39" x="1870.1" y="2054.7" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <rect id="map-40-40" x="1870.1" y="2141.5" width="189.73" height="78.416" fill="#ddd" class="map-shape"/>
            <!-- LINES -->
            <g fill="none" stroke="#838fc4" stroke-width="6.75px" opacity="0.5">
                <path d="m1660.1 531.7c96.381 0 1.127-347.15 115.12-347.15"/>
                <path d="m820.18 531.7c-96.381 0-1.127-390.55-115.12-390.55"/>
                <path d="m820.18 1312.8c-96.381 0-1.127-303.76-115.12-303.76"/>
                <path d="m820.18 1312.8c-94.782 0-1.127-173.58-115.12-173.58"/>
                <path d="m820.18 1312.8c-52.396 0-1.127-43.394-115.12-43.394"/>
                <path d="m820.18 2093.9c-96.381 0-1.127-347.15-115.12-347.15"/>
                <path d="m820.18 2093.9c-90.751 0-1.127-216.97-115.12-216.97"/>
                <path d="m820.18 2093.9h-115.12"/>
                <path d="m820.18 531.7c-61.986 0-1.127-43.394-115.12-43.394"/>
                <path d="m820.18 531.7c-94.334 0-1.127-216.97-115.12-216.97"/>
                <path d="m1660.1 1312.8c96.381 0 1.127-390.55 115.12-390.55"/>
                <path d="m1660.1 2093.9c96.381 0 1.127-477.33 115.12-477.33"/>
                <path d="m1660.1 2093.9c96.381 0 1.127-43.394 115.12-43.394"/>
                <path d="m1660.1 2093.9c94.87 0 1.127-303.76 115.12-303.76"/>
                <path d="m1660.1 1312.8c81.026 0 1.127-130.18 115.12-130.18"/>
                <path d="m1660.1 1312.8c96.381 0 1.127 43.394 115.12 43.394"/>
                <path d="m1660.1 531.7c82.37 0 1.127-130.18 115.12-130.18"/>
                <path d="m1660.1 531.7c96.381 0 1.127 43.394 115.12 43.394"/>
            </g>

            <!-- LABELS -->
            <g class="map-text" font-family="'Arabic Typesetting'" font-size="53.333px" text-anchor="middle" direction="rtl">
                <text x="1238.7888" y="397.33014">الهَوَى</text>
                <text x="1238.88" y="1182.9497">العَقْل</text>
                <text x="1238.9451" y="1964.6289">الخِدْمَة</text>
            </g>
            <g class="map-text" font-family="'Arabic Typesetting'" font-size="53.333px" text-anchor="middle">
                <text x="594.07471" y="2297.156">Introvert</text>
                <text x="1885.2305" y="2297.156">Extrovert</text>
            </g>
            <g class="map-text" font-family="'Arabic Typesetting'" font-size="42.667px" text-anchor="middle">
                <text x="1238.7888" y="455.33014">KARSA</text>
                <text x="1238.88" y="1240.9497">CIPTA</text>
                <text x="1238.9451" y="2022.6289">RASA</text>
            </g>
            <g class="map-text" font-family="'Arabic Typesetting'" font-size="42.667px" text-anchor="middle">
                <text x="931.29" y="460.81">BEKERJA KERAS</text>
                <text x="941.99" y="1240.87">BERPIKIR</text>
                <text x="935.87" y="2022.66">BERPERASAAN</text>
                <text x="1545.02" y="460.69">MEMPENGARUHI</text>
                <text x="1543.74" y="1239.58">BEKERJASAMA</text>
                <text x="1543.80" y="2022.62">MELAYANI</text>
            </g>
            <g class="map-text" font-family="'Arabic Typesetting'" font-size="42.667px" text-anchor="end">
                <text x="390.69" y="384.19">Berwibawa</text>
                <text x="391.78" y="209.51">Perfeksionis</text>
                <text x="389.71" y="471.17">Bertekad Kuat</text>
                <text x="391.14" y="565.28">Bersemangat</text>
                <text x="388.89" y="121.92">Cita-Cita Tinggi</text>
                <text x="389.11" y="296.35">Harga Diri</text>
                <text x="389.28" y="1261.18">Cerdas</text>
                <text x="389.85" y="1341.99">Ahli Hikmah</text>
                <text x="389.08" y="1079.96">Cerdik</text>
                <text x="390.66" y="991.10">Berfirasat</text>
                <text x="393.97" y="1167.32">Husnuzhan</text>
                <text x="389.29" y="2034.37">Pemalu</text>
                <text x="390.78" y="1949.44">Pendiam</text>

                <text x="390.45" y="1772.48">Jujur</text>
                <text x="388.83" y="1863.42">Menjaga Diri</text>

                <text x="389.92" y="2124.42">Sederhana</text>
                <text x="391.17" y="2202.27">Penyabar</text>
            </g>
            <g class="map-text" font-family="'Arabic Typesetting'" font-size="42.667px" text-anchor="start">
                <text x="2073.77" y="306.14">Kompetitif</text>
                <text x="2073.34" y="127.08">Pemberani</text>
                <text x="2075.60" y="644.54">Dermawan</text>
                <text x="2075.06" y="558.35">Menolong</text>
                <text x="2073.52" y="469.74">Komunikatif</text>
                <text x="2073.46" y="384.54">Penasehat</text>
                <text x="2075.99" y="212.36">Pencemburu</text>
                <text x="2073.42" y="1250.51">Berseri-seri</text>
                <text x="2075.44" y="1338.76">Lemah Lembut</text>
                <text x="2075.44" y="1076.47">Tepat Janji</text>
                <text x="2074.15" y="817.76">Bekerjasama</text>
                <text x="2075.65" y="911.18">Bersatu</text>
                <text x="2075.20" y="1428.29">Berbelas Kasih</text>
                <text x="2074.95" y="995.38">Adil</text>
                <text x="2075.38" y="1171.92">Humoris</text>
                <text x="2075.04" y="1952.10">Amanah</text>
                <text x="2076.22" y="2038.88">Tidak Tergesa</text>
                <text x="2076.20" y="1860.67">Menutup Aib</text>
                <text x="2075.61" y="2118.71">Santun</text>
                <text x="2067.37" y="1772.49">Jaga Rahasia</text>
                <text x="2075.88" y="1685.69">Melayani</text>
                <text x="2076.21" y="2207.49">Rendah Hati</text>
                <text x="2075.17" y="1599.40">Penuh Cinta</text>
            </g>
        </svg>`;

            // --- INIT & FETCH ---
            window.onload = () => {
                initTheme();

                fetch(JSON_URL)
                    .then((res) => {
                        if (!res.ok) throw new Error("Gagal mengambil JSON");
                        return res.json();
                    })
                    .then((jsonData) => {
                        // ROBUST DATA PARSING
                        let pillarsList = [];
                        // Case A: Nested Structure
                        if (
                            jsonData.parts?.tb40?.pillars &&
                            Array.isArray(jsonData.parts.tb40.pillars)
                        ) {
                            pillarsList = jsonData.parts.tb40.pillars;
                        }
                        // Case B: Group-Keyed Object
                        else if (
                            jsonData["2"] &&
                            Array.isArray(jsonData["2"])
                        ) {
                            Object.keys(jsonData).forEach((k) => {
                                if (Array.isArray(jsonData[k])) {
                                    jsonData[k].forEach((i) => {
                                        i.groupId = k;
                                        pillarsList.push(i);
                                    });
                                }
                            });
                        }
                        // Case C: Flat Array
                        else if (Array.isArray(jsonData)) {
                            pillarsList = jsonData;
                        }
                        // Case D: Fallback
                        else {
                            Object.values(jsonData).forEach((val) => {
                                if (
                                    Array.isArray(val) &&
                                    val.length > 0 &&
                                    val[0].pillar
                                ) {
                                    pillarsList = pillarsList.concat(val);
                                }
                            });
                        }

                        // NORMALIZE DATA
                        allItems = [];
                        rawData = {};

                        pillarsList.forEach((item) => {
                            if (!item.groupId && item.pillar?.group) {
                                item.groupId = item.pillar.group;
                            }
                            if (item.groupId) {
                                allItems.push(item);
                                if (!rawData[item.groupId])
                                    rawData[item.groupId] = [];
                                rawData[item.groupId].push(item);
                            }
                        });

                        // INIT MAP
                        const mapContainer =
                            document.getElementById("map-container");
                        mapContainer.innerHTML = svgMapTemplate;
                        setTimeout(colorMap, 50);

                        // UI UPDATE
                        document
                            .getElementById("loading-indicator")
                            .classList.add("hidden");
                        document
                            .getElementById("main-content-wrapper")
                            .classList.remove("hidden");

                        renderFilters();
                        renderCards();
                        renderTable();
                    })
                    .catch((err) => {
                        console.error(err);
                        document.getElementById("loading-indicator").innerHTML =
                            `<div class="alert alert-error max-w-md"><span>Gagal memuat data.</span></div>`;
                    });
            };

            // --- LOGIC FUNCTIONS (From Your Reference) ---
            function findItem(group, no) {
                if (!rawData[group]) return null;
                return rawData[group].find(
                    (i) => i.pillar && i.pillar.no === no,
                );
            }

            function getLineageColor(item) {
                let queue = [item];
                let visited = new Set();
                while (queue.length > 0) {
                    let curr = queue.shift();
                    const uid =
                        curr.groupId +
                        "-" +
                        (curr.pillar ? curr.pillar.no : "x");
                    if (visited.has(uid)) continue;
                    visited.add(uid);
                    if (curr.groupId === "3") {
                        if (curr.pillar.no === "1") return "red";
                        if (curr.pillar.no === "2") return "yellow";
                        if (curr.pillar.no === "3") return "green";
                    }
                    if (curr.parents && curr.parents.length > 0) {
                        curr.parents.forEach((p) => {
                            if (p.group === "2") return;
                            const parentItem = findItem(p.group, p.no);
                            if (parentItem) queue.push(parentItem);
                        });
                    }
                }
                return "gray";
            }

            function getPolarity(item) {
                let queue = [item];
                let visited = new Set();
                while (queue.length > 0) {
                    let curr = queue.shift();
                    const uid =
                        curr.groupId +
                        "-" +
                        (curr.pillar ? curr.pillar.no : "x");
                    if (visited.has(uid)) continue;
                    visited.add(uid);

                    if (curr.groupId === "2") {
                        if (curr.pillar.no === "1") return "Introvert";
                        if (curr.pillar.no === "2") return "Extrovert";
                    }

                    if (curr.parents && curr.parents.length > 0) {
                        curr.parents.forEach((p) => {
                            const parentItem = findItem(p.group, p.no);
                            if (parentItem) queue.push(parentItem);
                        });
                    }
                }
                return null;
            }

            function getCardStyles(color) {
                switch (color) {
                    case "red":
                        return {
                            border: "border-l-4 border-l-red-500",
                            badge: "badge-error text-white",
                            text: "text-red-600",
                            hex: "#f87171",
                            name: "Karsa",
                        };
                    case "yellow":
                        return {
                            border: "border-l-4 border-l-yellow-500",
                            badge: "badge-warning text-black",
                            text: "text-yellow-600",
                            hex: "#facc15",
                            name: "Cipta",
                        };
                    case "green":
                        return {
                            border: "border-l-4 border-l-green-500",
                            badge: "badge-success text-white",
                            text: "text-green-600",
                            hex: "#4ade80",
                            name: "Rasa",
                        };
                    default:
                        return {
                            border: "border-l-4 border-l-base-300",
                            badge: "badge-ghost",
                            text: "text-base-content",
                            hex: "#d1d5db",
                            name: "Umum",
                        };
                }
            }

            function colorMap() {
                allItems.forEach((item) => {
                    const mapId = `map-${item.groupId}-${item.pillar.no}`;
                    const el = document.getElementById(mapId);
                    if (el) {
                        const colorCode = getLineageColor(item);
                        const styles = getCardStyles(colorCode);
                        if (item.groupId === "2") {
                            el.setAttribute(
                                "fill",
                                item.pillar.no === "1" ? "#9333ea" : "#06b6d4",
                            );
                            el.setAttribute("fill-opacity", "0.2");
                        } else {
                            el.setAttribute("fill", styles.hex);
                        }
                        el.onclick = () => openDetail(item);

                        // Tooltip
                        let title = el.querySelector("title");
                        if (!title) {
                            title = document.createElementNS(
                                "http://www.w3.org/2000/svg",
                                "title",
                            );
                            el.appendChild(title);
                        }
                        title.textContent = item.name;
                    }
                });
            }

            // --- RENDER & INTERACTION ---
            let currentCategory = "all";
            let searchQuery = "";
            function filterCategory(c) {
                currentCategory = c;
                renderFilters();
                renderCards();
            }
            function handleSearch() {
                searchQuery = document
                    .getElementById("global-search")
                    .value.toLowerCase();
                renderCards();
                renderTable();
            }

            function switchView(v) {
                document
                    .getElementById("view-exploration")
                    .classList.toggle("hidden", v !== "exploration");
                document
                    .getElementById("view-table")
                    .classList.toggle("hidden", v !== "table");
                document
                    .getElementById("tab-exploration")
                    .classList.toggle("tab-active", v === "exploration");
                document
                    .getElementById("tab-table")
                    .classList.toggle("tab-active", v === "table");
            }

            function renderFilters() {
                const container = document.getElementById("category-filters");
                const groups = [
                    "all",
                    ...Object.keys(rawData).sort(
                        (a, b) => parseInt(a) - parseInt(b),
                    ),
                ];
                let html = "";
                groups.forEach((cat) => {
                    const label =
                        cat === "all"
                            ? "Semua"
                            : cat === "40"
                              ? "40 Pilar"
                              : cat === "2"
                                ? "Int/Ext"
                                : `Kelompok ${cat}`;
                    html += `<button class="btn btn-sm ${currentCategory === cat ? "btn-primary" : "btn-outline"} category-btn" onclick="filterCategory('${cat}')">${label}</button>`;
                });
                container.innerHTML = html;
            }

            function renderCards() {
                const grid = document.getElementById("content-grid");
                grid.innerHTML = "";

                const filtered = allItems.filter((item) => {
                    const q = searchQuery.toLowerCase();
                    const matchSearch =
                        item.name.toLowerCase().includes(q) ||
                        (item.data.definisi || "").toLowerCase().includes(q);
                    return (
                        (currentCategory === "all" ||
                            item.groupId === currentCategory) &&
                        matchSearch
                    );
                });

                if (filtered.length === 0) {
                    document
                        .getElementById("empty-state")
                        .classList.remove("hidden");
                    return;
                }
                document.getElementById("empty-state").classList.add("hidden");

                filtered.forEach((item) => {
                    const color = getLineageColor(item);
                    const style = getCardStyles(color);
                    const polarity = getPolarity(item);

                    let badges = `<span class="badge ${style.badge} badge-xs font-bold uppercase tracking-wider">${style.name}</span>`;
                    if (polarity) {
                        const polColor =
                            polarity === "Introvert"
                                ? "bg-purple-100 text-purple-700 border-purple-200"
                                : "bg-cyan-100 text-cyan-700 border-cyan-200";
                        badges += `<span class="badge ${polColor} badge-xs font-bold uppercase tracking-wider ml-1">${polarity}</span>`;
                    }

                    const card = document.createElement("div");
                    card.className = `card bg-base-100 shadow-sm hover:shadow-lg transition-all border border-base-200 cursor-pointer ${style.border}`;
                    card.onclick = () => openDetail(item);
                    card.innerHTML = `
                    <div class="card-body p-4">
                        <h3 class="font-bold text-lg">${item.name}</h3>
                        ${item.data.arab ? `<p class="font-arab text-xl text-right ${style.text}">${item.data.arab}</p>` : ""}
                        <p class="text-sm opacity-70 line-clamp-2 mt-1">${item.data.definisi || "-"}</p>
                        <div class="mt-3 flex flex-wrap gap-1">${badges}</div>
                    </div>
                `;
                    grid.appendChild(card);
                });
            }

            function renderTable() {
                const tbody = document.getElementById("table-body");
                tbody.innerHTML = "";
                const filtered = allItems.filter((item) => {
                    const q = searchQuery.toLowerCase();
                    const matchSearch =
                        item.name.toLowerCase().includes(q) ||
                        (item.data.definisi || "").toLowerCase().includes(q);
                    return (
                        (currentCategory === "all" ||
                            item.groupId === currentCategory) &&
                        matchSearch
                    );
                });

                filtered.forEach((item) => {
                    const color = getLineageColor(item);
                    const style = getCardStyles(color);
                    const polarity = getPolarity(item);
                    const tr = document.createElement("tr");
                    tr.onclick = () => openDetail(item);
                    tr.innerHTML = `
                    <td class="font-bold">${item.name}</td>
                    <td class="font-arab text-lg">${item.data.arab || "-"}</td>
                    <td><span class="badge ${style.badge} badge-sm">${style.name}</span></td>
                    <td>${polarity ? `<span class="badge badge-sm badge-outline">${polarity}</span>` : "-"}</td>
                    <td>${item.data.definisi || "-"}</td>
                    <td><span class="badge badge-ghost badge-sm">Group ${item.groupId}</span></td>
                `;
                    tbody.appendChild(tr);
                });
            }

            function openDetail(item) {
                const modal = document.getElementById("detail_modal");
                const content = document.getElementById("modal-content");
                const color = getLineageColor(item);
                const style = getCardStyles(color);
                const polarity = getPolarity(item);
                const d = item.data;

                // Extra Content logic
                let extraContent = "";

                // Group 3
                if (item.groupId === "3") {
                    extraContent += `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                        <div class="bg-blue-50 text-blue-900 p-4 rounded-lg border border-blue-100">
                            <h4 class="font-bold text-sm uppercase mb-2 flex items-center gap-2"><i class="fa-solid fa-book-open"></i> Gaya Belajar</h4>
                            <p class="font-arab text-xl mb-1">${d.gaya_belajar_arab || ""}</p>
                            <p class="font-bold text-lg">${d.gaya_belajar || "-"}</p>
                            <p class="text-sm mt-2 opacity-80 leading-relaxed">${d.gaya_belajar_definisi || ""}</p>
                        </div>
                        <div class="bg-pink-50 text-pink-900 p-4 rounded-lg border border-pink-100">
                            <h4 class="font-bold text-sm uppercase mb-2 flex items-center gap-2"><i class="fa-solid fa-heart"></i> Bahasa Hati</h4>
                            <p class="font-bold text-lg">${d.bahasa_hati || "-"}</p>
                            <p class="text-sm mt-2 opacity-80 leading-relaxed">${d.bahasa_hati_definisi || ""}</p>
                        </div>
                    </div>`;
                }

                // Group 40
                if (item.groupId === "40") {
                    extraContent += `
                    <div class="divider text-xs font-bold uppercase tracking-widest opacity-50 my-6">Diagnosa Ekstrem</div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="bg-error/10 border border-error/20 p-4 rounded-lg">
                            <div class="flex items-center gap-2 mb-2"><span class="badge badge-error badge-sm text-white">Lalai/Meremehkan</span></div>
                            <div class="font-arab text-2xl mb-1">${d.lalai_arab || ""}</div>
                            <div class="font-bold text-lg">${d.lalai_nama_lengkap || "-"}</div>
                            <p class="text-sm mt-1 italic opacity-80">"${d.lalai_definisi || "-"}"</p>
                        </div>
                        <div class="bg-warning/10 border border-warning/20 p-4 rounded-lg">
                            <div class="flex items-center gap-2 mb-2"><span class="badge badge-warning badge-sm">Berlebihan</span></div>
                            <div class="font-arab text-2xl mb-1">${d.lebih_arab || ""}</div>
                            <div class="font-bold text-lg">${d.lebih_nama_lengkap || "-"}</div>
                            <p class="text-sm mt-1 italic opacity-80">"${d.lebih_definisi || "-"}"</p>
                        </div>
                    </div>
                    <div class="bg-success/10 border border-success/20 p-4 rounded-lg">
                        <h4 class="font-bold text-success text-sm mb-2 uppercase"><i class="fa-solid fa-briefcase"></i> Potensi Karir</h4>
                        <p class="text-sm mb-2"><strong>Profesi:</strong> ${d.profesi || "-"}</p>
                        <p class="text-sm"><strong>Jurusan:</strong> ${d.jurusan || "-"}</p>
                    </div>`;
                }

                const buildLinks = (arr, icon) =>
                    arr
                        .map((p) => {
                            const t = findItem(p.group, p.no);
                            return t
                                ? `<button class="btn btn-xs btn-outline" onclick='openDetail(${JSON.stringify(t).replace(/'/g, "&#39;")})'><i class="fa-solid ${icon}"></i> ${t.name}</button>`
                                : "";
                        })
                        .join(" ");
                const parents = item.parents
                    ? buildLinks(item.parents, "fa-arrow-up")
                    : "";
                const children = allItems.filter(
                    (c) =>
                        c.parents &&
                        c.parents.some(
                            (p) =>
                                p.group === item.groupId &&
                                p.no === item.pillar.no,
                        ),
                );
                const childLinks = children
                    .map(
                        (c) =>
                            `<button class="btn btn-xs btn-outline btn-accent" onclick='openDetail(${JSON.stringify(c).replace(/'/g, "&#39;")})'><i class="fa-solid fa-arrow-down"></i> ${c.name}</button>`,
                    )
                    .join(" ");

                // Inject SVG Clone for Modal Highlight
                const mapHtml = `<div class="mb-6 w-full overflow-hidden bg-white rounded-lg p-2 flex justify-center border border-base-200 shadow-inner">${svgMapTemplate.replace('id="main-map-svg"', 'id="modal-map-svg"')}</div>`;

                content.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2">
                        <div class="flex flex-wrap items-center gap-2 mb-2">
                            <h2 class="text-3xl font-bold text-primary mr-2">${item.name}</h2>
                            <span class="badge ${style.badge} badge-lg uppercase font-bold">${style.name}</span>
                            ${polarity ? `<span class="badge badge-neutral badge-outline badge-lg uppercase font-bold">${polarity}</span>` : ""}
                        </div>
                        ${item.groupId === "40" ? `<h3 class="text-lg font-bold opacity-70 mb-2">${d.nama_lengkap || ""}</h3>` : ""}
                        <p class="font-arab text-4xl mb-4 leading-relaxed ${style.text}">${d.arab || ""}</p>
                        <p class="text-xl font-medium opacity-80 italic mb-6">"${d.definisi || ""}"</p>
                        ${d.uraian ? `<p class="mb-4 bg-base-200 p-3 rounded text-sm">${d.uraian}</p>` : ""}

                        <div class="bg-base-200 p-4 rounded-lg mb-4 text-sm">
                            <h4 class="font-bold opacity-50 mb-2 uppercase">Hubungan Keluarga Bakat</h4>
                            <div class="mb-2 flex flex-wrap gap-2 items-center"><span class="font-bold w-24">Orang Tua:</span> ${parents || '<span class="opacity-50">-</span>'}</div>
                            <div class="flex flex-wrap gap-2 items-center"><span class="font-bold w-24">Turunan:</span> ${childLinks || '<span class="opacity-50">-</span>'}</div>
                        </div>

                        ${extraContent}
                    </div>
                    <div class="lg:col-span-1">
                        ${mapHtml}
                        <div class="text-center text-xs opacity-50 mt-2">Lokasi pada Peta</div>
                    </div>
                </div>
            `;

                modal.showModal();

                // Highlight Animation Logic in Modal
                setTimeout(() => {
                    const mSvg = document.getElementById("modal-map-svg");
                    if (!mSvg) return;

                    // Colorize clone based on lineage logic
                    allItems.forEach((i) => {
                        const el = mSvg.querySelector(
                            `[id="map-${i.groupId}-${i.pillar.no}"]`,
                        );
                        if (el) {
                            const c = getLineageColor(i);
                            if (i.groupId === "2") {
                                el.setAttribute(
                                    "fill",
                                    i.pillar.no === "1" ? "#9333ea" : "#06b6d4",
                                );
                                el.setAttribute("fill-opacity", "0.2");
                            } else {
                                el.setAttribute("fill", getCardStyles(c).hex);
                            }
                        }
                    });

                    // Add Pulse Class to Current Item
                    const target = mSvg.querySelector(
                        `[id="map-${item.groupId}-${item.pillar.no}"]`,
                    );
                    if (target) {
                        target.classList.add("map-highlight");
                        // Scroll to shape logic (SVG viewBox centering trick or scrollIntoView)
                        // For now scrollIntoView works for overflow containers
                        target.scrollIntoView({
                            behavior: "smooth",
                            block: "center",
                            inline: "center",
                        });
                    }
                }, 50);
            }

            // --- UTILS ---
            function copyTableData() {
                const t = document.getElementById("data-table-el");
                const txt = Array.from(t.rows)
                    .map((row) =>
                        Array.from(row.cells)
                            .map((c) => c.innerText)
                            .join("\t"),
                    )
                    .join("\n");
                navigator.clipboard.writeText(txt).then(() => {
                    const toast = document.createElement("div");
                    toast.className = "alert alert-success shadow-lg";
                    toast.innerHTML = "<span>Data disalin!</span>";
                    document
                        .getElementById("toast-container")
                        .appendChild(toast);
                    setTimeout(() => toast.remove(), 2000);
                });
            }
            function initTheme() {
                const t =
                    localStorage.getItem("theme") ||
                    (window.matchMedia("(prefers-color-scheme: dark)").matches
                        ? "dracula"
                        : "cupcake");
                document.documentElement.setAttribute("data-theme", t);
                document.getElementById("theme-toggle").checked =
                    t === "dracula";
            }
            document
                .getElementById("theme-toggle")
                .addEventListener("change", (e) => {
                    const t = e.target.checked ? "dracula" : "cupcake";
                    document.documentElement.setAttribute("data-theme", t);
                    localStorage.setItem("theme", t);
                });
        </script>
    </body>
</html>
