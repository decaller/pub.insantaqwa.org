<!doctype html>
<html lang="id" data-theme="cupcake">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Tafsir Bakat 40 - Eksplorasi Lengkap</title>

        <!-- Libraries -->
        <link
            href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css"
            rel="stylesheet"
            type="text/css"
        />
        <script src="https://cdn.tailwindcss.com"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400&family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />

        <style>
            body {
                font-family: "Plus Jakarta Sans", sans-serif;
                transition: background-color 0.3s ease;
            }
            .font-arab {
                font-family: "Amiri", serif;
                line-height: 1.6;
            }

            /* Smooth fade */
            .fade-in {
                animation: fadeIn 0.4s ease-out;
            }
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* Map Styles */
            svg {
                width: 100%;
                height: auto;
                max-height: 70vh;
            }
            svg path,
            svg rect,
            svg circle,
            svg g {
                transition: all 0.2s ease;
                cursor: pointer;
            }
            /* Target elements with IDs like "2.1", "40.5", etc. */
            [id*="."]:hover {
                filter: brightness(0.85);
                stroke: currentColor;
                stroke-width: 2px;
                opacity: 0.8;
            }

            /* Card Animations */
            .hover-scale {
                transition: transform 0.2s;
            }
            .hover-scale:hover {
                transform: translateY(-3px);
            }

            /* Custom Scrollbar for Modal */
            .custom-scroll::-webkit-scrollbar {
                width: 8px;
            }
            .custom-scroll::-webkit-scrollbar-track {
                background: transparent;
            }
            .custom-scroll::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 4px;
            }
        </style>
    </head>
    <body class="bg-base-200 min-h-screen flex flex-col">
        <!-- Navbar (Integrated Style) -->
        <div class="navbar bg-base-100 shadow-md sticky top-0 z-50">
            <div class="navbar-start">
                <a class="btn btn-ghost text-xl font-bold text-primary gap-2">
                    <i class="fa-solid fa-compass"></i>
                    <span class="hidden sm:inline">TB40 Explorer</span>
                </a>
            </div>
            <div class="navbar-center">
                <div role="tablist" class="tabs tabs-boxed bg-base-200">
                    <a
                        role="tab"
                        class="tab tab-active transition-all"
                        id="tab-map"
                        onclick="switchTab('map')"
                    >
                        <i class="fa-solid fa-map mr-2"></i> Peta
                    </a>
                    <a
                        role="tab"
                        class="tab transition-all"
                        id="tab-cards"
                        onclick="switchTab('cards')"
                    >
                        <i class="fa-solid fa-magnifying-glass mr-2"></i>
                        Eksplorasi
                    </a>
                    <a
                        role="tab"
                        class="tab transition-all"
                        id="tab-table"
                        onclick="switchTab('table')"
                    >
                        <i class="fa-solid fa-table mr-2"></i> Tabel
                    </a>
                </div>
            </div>
            <div class="navbar-end gap-2">
                <!-- Theme Toggle -->
                <label
                    class="swap swap-rotate btn btn-ghost btn-circle text-base-content"
                >
                    <input type="checkbox" id="theme-toggle" />
                    <!-- sun icon -->
                    <svg
                        class="swap-on fill-current w-6 h-6"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                    >
                        <path
                            d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"
                        />
                    </svg>
                    <!-- moon icon -->
                    <svg
                        class="swap-off fill-current w-6 h-6"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                    >
                        <path
                            d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"
                        />
                    </svg>
                </label>
            </div>
        </div>

        <!-- Main Content -->
        <main class="container mx-auto p-4 md:p-6 flex-grow">
            <!-- Search & Loading -->
            <div class="mb-6 flex flex-col items-center">
                <div
                    id="loading-indicator"
                    class="flex flex-col items-center gap-4"
                >
                    <span
                        class="loading loading-spinner loading-lg text-primary"
                    ></span>
                    <span class="text-sm opacity-60"
                        >Mengambil data dan peta...</span
                    >
                </div>

                <div id="main-content-wrapper" class="w-full hidden fade-in">
                    <!-- Search Bar -->
                    <div class="form-control w-full max-w-lg mx-auto mb-6">
                        <input
                            type="text"
                            id="global-search"
                            placeholder="Cari sifat, definisi, atau kata kunci..."
                            class="input input-bordered w-full shadow-sm"
                            onkeyup="handleSearch()"
                        />
                    </div>

                    <!-- TAB 1: PETA VISUAL -->
                    <div id="view-map" class="view-section">
                        <div
                            class="card bg-base-100 shadow-xl border border-base-200"
                        >
                            <div class="card-body p-4">
                                <h2
                                    class="card-title justify-center mb-4 text-base-content"
                                >
                                    Peta Visual Tafsir Bakat
                                </h2>
                                <div
                                    class="flex justify-center w-full overflow-x-auto bg-base-100 rounded-box p-4 border relative min-h-[300px]"
                                    id="map-container"
                                >
                                    <!-- SVG Injected via JS -->
                                </div>
                                <div
                                    class="text-center text-sm opacity-60 mt-2"
                                >
                                    Klik area berwarna pada peta untuk melihat
                                    detail lengkap.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 2: EKSPLORASI KARTU -->
                    <div id="view-cards" class="view-section hidden">
                        <!-- Filters -->
                        <div
                            class="flex flex-wrap gap-2 justify-center mb-6"
                            id="category-filters"
                        >
                            <!-- Filters Injected JS -->
                        </div>

                        <div id="cards-container" class="space-y-8">
                            <!-- Groups Injected JS -->
                        </div>
                    </div>

                    <!-- TAB 3: TABEL DATA -->
                    <div id="view-table" class="view-section hidden">
                        <div
                            class="card bg-base-100 shadow-xl overflow-hidden border border-base-200"
                        >
                            <div class="overflow-x-auto h-[70vh]">
                                <table
                                    class="table table-pin-rows table-zebra w-full"
                                >
                                    <thead>
                                        <tr
                                            class="bg-base-200 text-base-content"
                                        >
                                            <th>No</th>
                                            <th>Nama Sifat</th>
                                            <th>Arab</th>
                                            <th>Group</th>
                                            <th>Definisi Singkat</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table-body">
                                        <!-- Rows Injected JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- DETAIL MODAL (POPUP LENGKAP) -->
        <dialog
            id="detail_modal"
            class="modal modal-bottom sm:modal-middle backdrop-blur-sm"
        >
            <div
                class="modal-box w-11/12 max-w-5xl p-0 bg-base-100 flex flex-col max-h-[90vh] shadow-2xl"
            >
                <!-- Header -->
                <div
                    class="bg-base-200 border-b border-base-300 p-4 sticky top-0 z-10 flex justify-between items-center"
                >
                    <div class="flex items-center gap-2">
                        <span
                            class="badge badge-primary font-bold"
                            id="modal-group-badge"
                            >Group</span
                        >
                        <span class="text-sm opacity-60" id="modal-pillar-no"
                            >No. 0</span
                        >
                    </div>
                    <form method="dialog">
                        <button class="btn btn-sm btn-circle btn-ghost">
                            âœ•
                        </button>
                    </form>
                </div>

                <!-- Content Scrollable -->
                <div
                    class="p-6 overflow-y-auto custom-scroll flex-grow"
                    id="modal-content"
                >
                    <!-- Content Injected via JS -->
                </div>
            </div>
            <form method="dialog" class="modal-backdrop">
                <button>close</button>
            </form>
        </dialog>

        <script>
            // --- GLOBAL STATE ---
            let allItems = [];
            let rawData = {};

            // --- CONFIGURATION ---
            const JSON_URL =
                "https://pub.insantaqwa.org/bakat/calculation.json";
            const SVG_URL = "https://pub.insantaqwa.org/bakat/tb40.svg";

            // --- INIT & FETCH ---
            window.onload = () => {
                initTheme();

                // Fetch both resources in parallel
                Promise.all([
                    fetch(JSON_URL).then((res) => {
                        if (!res.ok) throw new Error("Gagal mengambil JSON");
                        return res.json();
                    }),
                    fetch(SVG_URL).then((res) => {
                        if (!res.ok) throw new Error("Gagal mengambil SVG");
                        return res.text();
                    }),
                ])
                    .then(([jsonData, svgData]) => {
                        // 1. ROBUST DATA PARSING
                        let pillarsList = [];

                        // Determine structure:
                        // Case A: Nested Structure like { parts: { tb40: { pillars: [] } } }
                        if (
                            jsonData.parts?.tb40?.pillars &&
                            Array.isArray(jsonData.parts.tb40.pillars)
                        ) {
                            pillarsList = jsonData.parts.tb40.pillars;
                        }
                        // Case B: Group-Keyed Object like { "2": [], "3": [] } - Only iterate if values are arrays
                        else if (
                            jsonData["2"] &&
                            Array.isArray(jsonData["2"])
                        ) {
                            Object.keys(jsonData).forEach((k) => {
                                if (Array.isArray(jsonData[k])) {
                                    jsonData[k].forEach((i) => {
                                        i.groupId = k;
                                        pillarsList.push(i);
                                    });
                                }
                            });
                        }
                        // Case C: Flat Array
                        else if (Array.isArray(jsonData)) {
                            pillarsList = jsonData;
                        }
                        // Case D: Fallback - maybe it's just keys with mixed data
                        else {
                            // Try to extract from any key that holds an array of pillar-like objects
                            Object.values(jsonData).forEach((val) => {
                                if (
                                    Array.isArray(val) &&
                                    val.length > 0 &&
                                    val[0].pillar
                                ) {
                                    pillarsList = pillarsList.concat(val);
                                }
                            });
                        }

                        // 2. NORMALIZE DATA
                        allItems = [];
                        rawData = {}; // Reset rawData to be Group-Keyed for UI Compatibility

                        pillarsList.forEach((item) => {
                            // Extract Group ID from pillar data if not present on item root
                            if (!item.groupId && item.pillar?.group) {
                                item.groupId = item.pillar.group;
                            }

                            if (item.groupId) {
                                // Add to flat list
                                allItems.push(item);

                                // Add to grouped object (rawData)
                                if (!rawData[item.groupId])
                                    rawData[item.groupId] = [];
                                rawData[item.groupId].push(item);
                            }
                        });

                        // 3. Process SVG
                        const mapContainer =
                            document.getElementById("map-container");
                        mapContainer.innerHTML = svgData;

                        // Clean up SVG style
                        const svgEl = mapContainer.querySelector("svg");
                        if (svgEl) {
                            svgEl.removeAttribute("width");
                            svgEl.removeAttribute("height");
                            svgEl.classList.add("w-full", "h-auto");
                        }

                        // 4. UI Updates
                        document
                            .getElementById("loading-indicator")
                            .classList.add("hidden");
                        document
                            .getElementById("main-content-wrapper")
                            .classList.remove("hidden");

                        renderFilters();
                        renderCards();
                        renderTable();
                        bindMapEvents();
                    })
                    .catch((err) => {
                        console.error(err);
                        document.getElementById("loading-indicator").innerHTML =
                            `
                    <div class="alert alert-error max-w-md">
                        <i class="fa-solid fa-triangle-exclamation"></i>
                        <span>Gagal memuat data. <br><span class="text-xs opacity-70">${err.message}</span></span>
                    </div>`;
                    });
            };

            // --- THEME LOGIC ---
            function initTheme() {
                const t =
                    localStorage.getItem("theme") ||
                    (window.matchMedia("(prefers-color-scheme: dark)").matches
                        ? "dracula"
                        : "cupcake");
                document.documentElement.setAttribute("data-theme", t);
                document.getElementById("theme-toggle").checked =
                    t === "dracula";
            }
            document
                .getElementById("theme-toggle")
                .addEventListener("change", (e) => {
                    const t = e.target.checked ? "dracula" : "cupcake";
                    document.documentElement.setAttribute("data-theme", t);
                    localStorage.setItem("theme", t);
                });

            // --- TABS LOGIC ---
            function switchTab(tabName) {
                document
                    .querySelectorAll(".view-section")
                    .forEach((el) => el.classList.add("hidden"));
                document
                    .querySelectorAll(".tab")
                    .forEach((el) =>
                        el.classList.remove(
                            "tab-active",
                            "bg-primary",
                            "text-white",
                        ),
                    );

                document
                    .getElementById("view-" + tabName)
                    .classList.remove("hidden");
                const activeTab = document.getElementById("tab-" + tabName);
                activeTab.classList.add("tab-active");
            }

            // --- SEARCH LOGIC ---
            let searchQuery = "";
            let filterGroup = "all";

            function handleSearch() {
                searchQuery = document
                    .getElementById("global-search")
                    .value.toLowerCase();
                renderCards();
                renderTable();
            }

            function setFilter(group) {
                filterGroup = group;
                renderFilters();
                renderCards();
            }

            // --- RENDER FUNCTIONS ---
            function bindMapEvents() {
                // Bind click events to SVG elements based on IDs matching data (e.g., id="2.1")
                allItems.forEach((item) => {
                    const id = `${item.groupId}.${item.pillar.no}`;
                    const el = document.getElementById(id);
                    if (el) {
                        // Set style for pointer
                        el.style.cursor = "pointer";

                        // Click Event
                        el.onclick = () => openDetail(item);

                        // Add Tooltip (Title) if missing
                        let title = el.querySelector("title");
                        if (!title) {
                            title = document.createElementNS(
                                "http://www.w3.org/2000/svg",
                                "title",
                            );
                            el.appendChild(title);
                        }
                        title.textContent = `${item.name} (${item.data.arab || ""})`;
                    }
                });
            }

            function renderFilters() {
                const container = document.getElementById("category-filters");
                // Try to sort numerically if keys are numbers
                const groups = [
                    "all",
                    ...Object.keys(rawData).sort(
                        (a, b) => parseInt(a) - parseInt(b),
                    ),
                ];

                container.innerHTML = groups
                    .map((g) => {
                        const activeClass =
                            filterGroup === g ? "btn-primary" : "btn-outline";
                        const label = g === "all" ? "Semua" : `Group ${g}`;
                        return `<button class="btn btn-sm ${activeClass}" onclick="setFilter('${g}')">${label}</button>`;
                    })
                    .join("");
            }

            function renderCards() {
                const container = document.getElementById("cards-container");
                container.innerHTML = "";

                // Group data for display
                const groups = Object.keys(rawData).sort(
                    (a, b) => parseInt(a) - parseInt(b),
                );

                groups.forEach((gId) => {
                    if (filterGroup !== "all" && filterGroup !== gId) return;

                    const items = rawData[gId].filter(
                        (i) =>
                            i.name.toLowerCase().includes(searchQuery) ||
                            (i.data.definisi &&
                                i.data.definisi
                                    .toLowerCase()
                                    .includes(searchQuery)),
                    );

                    if (items.length === 0) return;

                    // Section Header
                    const section = document.createElement("div");
                    let colorClass = "border-l-4 border-base-content";
                    if (gId === "2")
                        colorClass = "border-l-4 border-purple-500";
                    if (gId === "3") colorClass = "border-l-4 border-blue-500";
                    if (gId === "6") colorClass = "border-l-4 border-green-500";
                    if (gId === "18")
                        colorClass = "border-l-4 border-yellow-500";
                    if (gId === "40") colorClass = "border-l-4 border-red-500";

                    section.innerHTML = `<h3 class="text-2xl font-bold mb-4 ${colorClass} pl-3">Group ${gId}</h3>`;

                    const grid = document.createElement("div");
                    grid.className =
                        "grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4";

                    items.forEach((item) => {
                        const card = document.createElement("div");
                        card.className =
                            "card bg-base-100 shadow-sm hover:shadow-lg border border-base-200 hover-scale cursor-pointer";
                        card.onclick = () => openDetail(item);

                        let badgeColor = "badge-neutral";
                        if (gId == "2") badgeColor = "badge-secondary";
                        if (gId == "3") badgeColor = "badge-info";
                        if (gId == "6") badgeColor = "badge-success";
                        if (gId == "18") badgeColor = "badge-warning";
                        if (gId == "40") badgeColor = "badge-error";

                        card.innerHTML = `
                        <div class="card-body p-4">
                            <div class="flex justify-between items-start">
                                <span class="badge ${badgeColor} badge-sm">${item.pillar.no}</span>
                                ${item.data.arab ? `<span class="font-arab text-xl text-primary">${item.data.arab}</span>` : ""}
                            </div>
                            <h3 class="card-title text-base mt-1">${item.name}</h3>
                            <p class="text-xs opacity-70 line-clamp-2">${item.data.definisi || item.data.uraian || "-"}</p>
                        </div>
                    `;
                        grid.appendChild(card);
                    });

                    section.appendChild(grid);
                    container.appendChild(section);
                });
            }

            function renderTable() {
                const tbody = document.getElementById("table-body");
                const filtered = allItems.filter(
                    (i) =>
                        (filterGroup === "all" || i.groupId === filterGroup) &&
                        (i.name.toLowerCase().includes(searchQuery) ||
                            (i.data.definisi &&
                                i.data.definisi
                                    .toLowerCase()
                                    .includes(searchQuery))),
                );

                tbody.innerHTML = filtered
                    .map(
                        (item) => `
                <tr class="hover cursor-pointer" onclick='openDetail(JSON.parse(\`${JSON.stringify(item).replace(/'/g, "\\'")}\`))'>
                    <td>${item.pillar.no}</td>
                    <td class="font-bold">${item.name}</td>
                    <td class="font-arab text-lg">${item.data.arab || "-"}</td>
                    <td><span class="badge badge-ghost badge-sm">Group ${item.groupId}</span></td>
                    <td class="text-sm truncate max-w-xs">${item.data.definisi || item.data.uraian || "-"}</td>
                    <td><button class="btn btn-xs btn-ghost"><i class="fa-solid fa-eye"></i></button></td>
                </tr>
            `,
                    )
                    .join("");
            }

            // --- HELPER FOR FAMILY TREE ---
            function findItem(group, no) {
                return allItems.find(
                    (i) => i.groupId == group && i.pillar.no == no,
                );
            }

            // --- POPUP / MODAL LOGIC (Enhanced with Family Tree) ---
            function openDetail(item) {
                const d = item.data;

                // Header
                document.getElementById("modal-group-badge").innerText =
                    `Group ${item.groupId}`;
                document.getElementById("modal-pillar-no").innerText =
                    `No. ${item.pillar.no}`;

                // Content Builder
                let contentHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-3xl font-bold mb-1 text-primary">${d.nama_lengkap || item.name}</h2>
                    ${d.arab ? `<h3 class="text-5xl font-arab my-4 leading-relaxed text-secondary">${d.arab}</h3>` : ""}
                    <div class="bg-base-200/50 p-4 rounded-xl border border-base-200 inline-block text-left w-full">
                        <p class="text-lg font-medium text-center">${d.definisi || d.uraian || "-"}</p>
                    </div>
                </div>
            `;

                // FAMILY TREE: PARENTS
                let parentsHTML = "";
                if (item.parents && item.parents.length > 0) {
                    item.parents.forEach((p) => {
                        const parent = findItem(p.group, p.no);
                        if (parent) {
                            const pStr = JSON.stringify(parent).replace(
                                /'/g,
                                "&#39;",
                            );
                            parentsHTML += `<button class="btn btn-sm btn-outline btn-neutral" onclick='openDetail(${pStr})'><i class="fa-solid fa-arrow-up"></i> ${parent.name}</button>`;
                        }
                    });
                }

                // FAMILY TREE: CHILDREN (Reverse Lookup)
                let childrenHTML = "";
                const children = allItems.filter(
                    (child) =>
                        child.parents &&
                        child.parents.some(
                            (p) =>
                                p.group == item.groupId &&
                                p.no == item.pillar.no,
                        ),
                );
                children.forEach((child) => {
                    const cStr = JSON.stringify(child).replace(/'/g, "&#39;");
                    childrenHTML += `<button class="btn btn-sm btn-outline btn-accent" onclick='openDetail(${cStr})'><i class="fa-solid fa-arrow-down"></i> ${child.name}</button>`;
                });

                // FAMILY TREE: SIBLINGS (Same Group)
                let siblingsHTML = "";
                const siblings = allItems
                    .filter((i) => i.groupId == item.groupId)
                    .sort((a, b) => a.pillar.no - b.pillar.no);
                siblings.forEach((sib) => {
                    const isCurrent = sib.pillar.no === item.pillar.no;
                    const sStr = JSON.stringify(sib).replace(/'/g, "&#39;");
                    siblingsHTML += `<button class="btn btn-xs ${isCurrent ? "btn-primary" : "btn-ghost"}" ${!isCurrent ? `onclick='openDetail(${sStr})'` : ""}>${sib.name}</button>`;
                });

                // GROUP 3 SPECIFIC (Gaya Belajar & Hati)
                if (item.groupId === "3") {
                    contentHTML += `
                <div class="divider mt-6">Info Spesifik</div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="alert alert-info shadow-sm items-start">
                        <i class="fa-solid fa-book-open mt-1"></i>
                        <div>
                            <h3 class="font-bold">Gaya Belajar: ${d.gaya_belajar || "-"}</h3>
                            <div class="text-xs">${d.gaya_belajar_definisi || ""}</div>
                        </div>
                    </div>
                    <div class="alert alert-error shadow-sm items-start bg-pink-100 text-pink-900 border-pink-200">
                        <i class="fa-solid fa-heart mt-1"></i>
                        <div>
                            <h3 class="font-bold">Bahasa Hati: ${d.bahasa_hati || "-"}</h3>
                            <div class="text-xs">${d.bahasa_hati_definisi || ""}</div>
                        </div>
                    </div>
                </div>`;
                }

                // GROUP 40 SPECIFIC (Lalai & Berlebihan)
                if (item.groupId === "40") {
                    contentHTML += `
                <div class="divider mt-8 text-error">Diagnosa Ekstrem</div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-error/10 border border-error/20 p-4 rounded-box">
                        <h4 class="font-bold text-error flex items-center gap-2 mb-2"><i class="fa-solid fa-circle-exclamation"></i> Lalai / Meremehkan</h4>
                        <div class="text-2xl font-arab text-neutral-content">${d.lalai_arab || ""}</div>
                        <div class="font-bold">${d.lalai_nama_lengkap || "-"}</div>
                        <p class="text-sm mt-2 opacity-80">${d.lalai_definisi || "-"}</p>
                        <div class="mt-3 text-xs bg-base-100 p-2 rounded">
                            <span class="font-bold">Solusi:</span> ${d.lalai_perbaiki || d.lalai_solusi || "-"}
                        </div>
                    </div>
                    <div class="bg-warning/10 border border-warning/20 p-4 rounded-box">
                        <h4 class="font-bold text-error flex items-center gap-2 mb-2"><i class="fa-solid fa-scale-unbalanced"></i> Berlebihan</h4>
                        <div class="text-2xl font-arab text-neutral-content">${d.lebih_arab || ""}</div>
                        <div class="font-bold">${d.lebih_nama_lengkap || "-"}</div>
                         <p class="text-sm mt-2 opacity-80">${d.lebih_definisi || "-"}</p>
                         <div class="mt-3 text-xs bg-base-100 p-2 rounded">
                            <span class="font-bold">Solusi:</span> ${d.lebih_perbaiki || d.lebih_solusi || "-"}
                        </div>
                    </div>
                </div>
                <div class="bg-base-200 p-4 mt-4 rounded-box">
                     <h4 class="font-bold text-sm mb-2 opacity-50 uppercase">Rekomendasi</h4>
                     <p class="text-sm"><span class="font-bold text-primary">Profesi:</span> ${d.profesi || "-"}</p>
                     <p class="text-sm mt-1"><span class="font-bold text-secondary">Jurusan:</span> ${d.jurusan || "-"}</p>
                </div>
                `;
                }

                // Add Family Tree Section
                contentHTML += `
                <div class="divider text-xs font-bold opacity-50 uppercase tracking-widest mt-8">Struktur Keluarga Bakat</div>
                <div class="bg-base-200 p-6 rounded-box">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                        <div class="bg-base-100 p-4 rounded-lg shadow-sm">
                            <div class="text-xs uppercase font-bold opacity-50 mb-2 flex items-center gap-2"><i class="fa-solid fa-level-up-alt"></i> Induk (Parents)</div>
                            <div class="flex flex-wrap gap-2">${parentsHTML || '<span class="text-xs italic opacity-50">Root / Tidak ada induk</span>'}</div>
                        </div>
                        <div class="bg-base-100 p-4 rounded-lg shadow-sm">
                            <div class="text-xs uppercase font-bold opacity-50 mb-2 flex items-center gap-2"><i class="fa-solid fa-level-down-alt"></i> Turunan (Children)</div>
                            <div class="flex flex-wrap gap-2">${childrenHTML || '<span class="text-xs italic opacity-50">Leaf / Tidak ada turunan</span>'}</div>
                        </div>
                    </div>
                    <div class="text-xs uppercase font-bold opacity-50 mb-2">Kelompok ${item.groupId} (Siblings)</div>
                    <div class="flex flex-wrap gap-2 justify-center">${siblingsHTML}</div>
                </div>
            `;

                document.getElementById("modal-content").innerHTML =
                    contentHTML;
                document.getElementById("detail_modal").showModal();
            }
        </script>
    </body>
</html>
