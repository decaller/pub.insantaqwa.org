<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Analisis Karakter - Ruh, Jiwa, Kecerdasan</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
        <script src="https://unpkg.com/@phosphor-icons/web"></script>
        <style>
            .btn-transition {
                transition: all 0.2s ease;
            }
            body {
                background-color: #f3f4f6;
                font-family: "Inter", sans-serif;
            }
            .no-scrollbar::-webkit-scrollbar {
                display: none;
            }
            .no-scrollbar {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
        </style>
    </head>
    <body class="h-screen flex flex-col items-center justify-center">
        <!-- Main Container -->
        <div
            class="bg-white w-full h-full flex flex-col overflow-hidden relative"
        >
            <!-- Header -->
            <div
                class="p-6 border-b border-gray-100 flex justify-between items-center bg-white z-10"
            >
                <div>
                    <h1 class="text-2xl font-bold text-gray-800">
                        Analisis Karakter
                    </h1>
                    <p class="text-sm text-gray-500">
                        Pemetaan Potensi Manusia
                    </p>
                </div>
                <div
                    class="text-xs font-mono text-gray-400 bg-gray-50 px-2 py-1 rounded"
                >
                    <span id="page-indicator">Page 1</span>
                </div>
            </div>

            <!-- Chart Container -->
            <div
                id="chart-container"
                class="w-full flex-1 min-h-0 bg-gray-50/30"
            ></div>

            <!-- Footer / Navigation -->
            <div
                class="p-3 border-t border-gray-200 bg-white flex items-center gap-2 w-full z-20"
            >
                <button
                    id="btn-prev"
                    onclick="prevPage()"
                    class="p-2 rounded-lg bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 text-gray-600 disabled:opacity-30 disabled:cursor-not-allowed btn-transition flex-shrink-0"
                >
                    <i class="ph-bold ph-caret-left text-lg"></i>
                </button>

                <div class="relative flex-1 overflow-hidden group">
                    <div
                        id="nav-container"
                        class="flex gap-2 overflow-x-auto no-scrollbar scroll-smooth px-1 py-1"
                    >
                        <!-- Buttons injected by JS -->
                    </div>
                    <div
                        class="absolute inset-y-0 left-0 w-4 bg-gradient-to-r from-white to-transparent pointer-events-none"
                    ></div>
                    <div
                        class="absolute inset-y-0 right-0 w-4 bg-gradient-to-l from-white to-transparent pointer-events-none"
                    ></div>
                </div>

                <button
                    id="btn-next"
                    onclick="nextPage()"
                    class="p-2 rounded-lg bg-gray-100 hover:bg-indigo-50 hover:text-indigo-600 text-gray-600 disabled:opacity-30 disabled:cursor-not-allowed btn-transition flex-shrink-0"
                >
                    <i class="ph-bold ph-caret-right text-lg"></i>
                </button>
            </div>
        </div>

        <script>
            // ==========================================
            // 1. DATA PREPARATION
            // ==========================================

            const palettes = {
                blue: [
                    "#E3F2FD",
                    "#BBDEFB",
                    "#90CAF9",
                    "#64B5F6",
                    "#42A5F5",
                    "#2196F3",
                    "#1E88E5",
                    "#1976D2",
                    "#1565C0",
                    "#0D47A1",
                ],
                brown: [
                    "#EFEBE9",
                    "#D7CCC8",
                    "#BCAAA4",
                    "#A1887F",
                    "#8D6E63",
                    "#795548",
                    "#6D4C41",
                    "#5D4037",
                    "#4E342E",
                    "#3E2723",
                ],
                // Adjusted palettes to match the Jiwa themes (Red, Yellow, Green)
                red: [
                    "#ffcdd2",
                    "#ef9a9a",
                    "#e57373",
                    "#ef5350",
                    "#f44336",
                    "#e53935",
                    "#d32f2f",
                ], // Ammarah / Karsa
                yellow: [
                    "#fff9c4",
                    "#fff59d",
                    "#fff176",
                    "#ffee58",
                    "#ffeb3b",
                    "#fdd835",
                    "#fbc02d",
                ], // Lawwamah / Cipta
                green: [
                    "#c8e6c9",
                    "#a5d6a7",
                    "#81c784",
                    "#66bb6a",
                    "#4caf50",
                    "#43a047",
                    "#388e3c",
                ], // Muthmainnah / Rasa
            };

            function getColor(type, index) {
                const palette = palettes[type] || palettes.blue;
                return palette[index % palette.length];
            }

            const rawDataGroups = [
                [
                    {
                        name: "Himmah",
                        nama: "bercita-cita tinggi",
                        score: 40,
                        groupId: "Berambisi_Bekerja keras_Karsa_Introvert_ruh",
                    },
                    {
                        name: "Ihsaan",
                        nama: "perfeksionis",
                        score: 30,
                        groupId: "Berambisi_Bekerja keras_Karsa_Introvert_ruh",
                    },
                    {
                        name: "‘izzah",
                        nama: "harga diri",
                        score: 40,
                        groupId: "Berwibawa_Bekerja keras_Karsa_Introvert_ruh",
                    },
                    {
                        name: "Waqaar",
                        nama: "berwibawa",
                        score: 50,
                        groupId: "Berwibawa_Bekerja keras_Karsa_Introvert_ruh",
                    },
                    {
                        name: "‘aziimah",
                        nama: "bertekad kuat",
                        score: 45,
                        groupId:
                            "Giat bekerja_Bekerja keras_Karsa_Introvert_ruh",
                    },
                    {
                        name: "Nasyaath",
                        nama: "bersemangat",
                        score: 50,
                        groupId:
                            "Giat bekerja_Bekerja keras_Karsa_Introvert_ruh",
                    },
                    {
                        name: "Firaasah",
                        nama: "berfirasat",
                        score: 40,
                        groupId:
                            "Suka berpikir imajinatif_Berpikir_Cipta_Introvert_ruh",
                    },
                    {
                        name: "Nubl",
                        nama: "cerdik",
                        score: 30,
                        groupId:
                            "Suka berpikir imajinatif_Berpikir_Cipta_Introvert_ruh",
                    },
                    {
                        name: "Husnuzhan",
                        nama: "berprasangka baik",
                        score: 45,
                        groupId:
                            "Suka berpikir positif_Berpikir_Cipta_Introvert_ruh",
                    },
                    {
                        name: "Dzakaa’",
                        nama: "cerdas",
                        score: 30,
                        groupId:
                            "Suka berpikir analitis_Berpikir_Cipta_Introvert_ruh",
                    },
                    {
                        name: "Hikmah",
                        nama: "ahli hikmah",
                        score: 30,
                        groupId:
                            "Suka berpikir analitis_Berpikir_Cipta_Introvert_ruh",
                    },
                    {
                        name: "Shidq",
                        nama: "jujur",
                        score: 45,
                        groupId:
                            "Suka apa adanya_Berperasaan_Rasa_Introvert_ruh",
                    },
                    {
                        name: "‘iffah",
                        nama: "menjaga diri",
                        score: 50,
                        groupId: "Pendiam_Berperasaan_Rasa_Introvert_ruh",
                    },
                    {
                        name: "Shamt",
                        nama: "pendiam",
                        score: 40,
                        groupId: "Pendiam_Berperasaan_Rasa_Introvert_ruh",
                    },
                    {
                        name: "Hayaa’",
                        nama: "pemalu",
                        score: 50,
                        groupId: "Suka merendah_Berperasaan_Rasa_Introvert_ruh",
                    },
                    {
                        name: "Qanaa'ah",
                        nama: "sederhana",
                        score: 40,
                        groupId: "Suka merendah_Berperasaan_Rasa_Introvert_ruh",
                    },
                    {
                        name: "Shabr",
                        nama: "penyabar",
                        score: 35,
                        groupId: "Suka merendah_Berperasaan_Rasa_Introvert_ruh",
                    },
                    {
                        name: "Syajaa’ah",
                        nama: "pemberani",
                        score: 50,
                        groupId:
                            "Suka menguasai_Mempengaruhi_Karsa_Extrovert_ruh",
                    },
                    {
                        name: "Ghairah",
                        nama: "pencemburu",
                        score: 45,
                        groupId:
                            "Suka menguasai_Mempengaruhi_Karsa_Extrovert_ruh",
                    },
                    {
                        name: "Munaafasah",
                        nama: "kompetitif",
                        score: 35,
                        groupId:
                            "Suka menguasai_Mempengaruhi_Karsa_Extrovert_ruh",
                    },
                    {
                        name: "Nashiihah",
                        nama: "penasehat",
                        score: 45,
                        groupId:
                            "Suka memotivasi_Mempengaruhi_Karsa_Extrovert_ruh",
                    },
                    {
                        name: "Fashaahah",
                        nama: "komunikatif",
                        score: 35,
                        groupId:
                            "Suka memotivasi_Mempengaruhi_Karsa_Extrovert_ruh",
                    },
                    {
                        name: "Nushrah",
                        nama: "menolong",
                        score: 35,
                        groupId:
                            "Suka menolong_Mempengaruhi_Karsa_Extrovert_ruh",
                    },
                    {
                        name: "Juud",
                        nama: "dermawan",
                        score: 45,
                        groupId:
                            "Suka menolong_Mempengaruhi_Karsa_Extrovert_ruh",
                    },
                    {
                        name: "Ta'aawun",
                        nama: "bekerjaasama",
                        score: 30,
                        groupId:
                            "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_ruh",
                    },
                    {
                        name: "Ulfah",
                        nama: "bersatu",
                        score: 40,
                        groupId:
                            "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_ruh",
                    },
                    {
                        name: "‘adaalah",
                        nama: "adil",
                        score: 30,
                        groupId:
                            "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_ruh",
                    },
                    {
                        name: "Wafaa'",
                        nama: "menepati janji",
                        score: 45,
                        groupId:
                            "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_ruh",
                    },
                    {
                        name: "Muzaah",
                        nama: "humoris",
                        score: 40,
                        groupId:
                            "Suka membuat hubungan baru_Bekerjasama_Cipta_Extrovert_ruh",
                    },
                    {
                        name: "Basyaasyah",
                        nama: "berseri-seri",
                        score: 50,
                        groupId:
                            "Suka membuat hubungan baru_Bekerjasama_Cipta_Extrovert_ruh",
                    },
                    {
                        name: "Rifq",
                        nama: "lemah lembut",
                        score: 50,
                        groupId:
                            "Suka mengeratkan hubungan yang sudah ada_Bekerjasama_Cipta_Extrovert_ruh",
                    },
                    {
                        name: "Rahmah",
                        nama: "berbelas kasih",
                        score: 45,
                        groupId:
                            "Suka mengeratkan hubungan yang sudah ada_Bekerjasama_Cipta_Extrovert_ruh",
                    },
                    {
                        name: "Mahabbah",
                        nama: "penuh cinta",
                        score: 30,
                        groupId:
                            "Suka melayani dengan cara memberi_Melayani_Rasa_Extrovert_ruh",
                    },
                    {
                        name: "Itsaar",
                        nama: "melayani",
                        score: 35,
                        groupId:
                            "Suka melayani dengan cara memberi_Melayani_Rasa_Extrovert_ruh",
                    },
                    {
                        name: "Kitmaanus sirr",
                        nama: "penjaga rahasia",
                        score: 50,
                        groupId:
                            "Suka melayani dengan cara menjaga_Melayani_Rasa_Extrovert_ruh",
                    },
                    {
                        name: "Satr",
                        nama: "menutup aib",
                        score: 30,
                        groupId:
                            "Suka melayani dengan cara menjaga_Melayani_Rasa_Extrovert_ruh",
                    },
                    {
                        name: "Amaanah",
                        nama: "bertanggung jawab",
                        score: 35,
                        groupId:
                            "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_ruh",
                    },
                    {
                        name: "Anaah",
                        nama: "tidak tergesa",
                        score: 40,
                        groupId:
                            "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_ruh",
                    },
                    {
                        name: "Hilm",
                        nama: "santun",
                        score: 35,
                        groupId:
                            "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_ruh",
                    },
                    {
                        name: "Tawaadhu'",
                        nama: "rendah hati",
                        score: 35,
                        groupId:
                            "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_ruh",
                    },
                ],
                [
                    {
                        name: "Himmah",
                        nama: "bercita-cita tinggi",
                        score: 40,
                        groupId:
                            "Berambisi_Bekerja keras_Karsa_Introvert_jasad",
                    },
                    {
                        name: "Ihsaan",
                        nama: "perfeksionis",
                        score: 30,
                        groupId:
                            "Berambisi_Bekerja keras_Karsa_Introvert_jasad",
                    },
                    {
                        name: "‘izzah",
                        nama: "harga diri",
                        score: 40,
                        groupId:
                            "Berwibawa_Bekerja keras_Karsa_Introvert_jasad",
                    },
                    {
                        name: "Waqaar",
                        nama: "berwibawa",
                        score: 50,
                        groupId:
                            "Berwibawa_Bekerja keras_Karsa_Introvert_jasad",
                    },
                    {
                        name: "‘aziimah",
                        nama: "bertekad kuat",
                        score: 45,
                        groupId:
                            "Giat bekerja_Bekerja keras_Karsa_Introvert_jasad",
                    },
                    {
                        name: "Nasyaath",
                        nama: "bersemangat",
                        score: 50,
                        groupId:
                            "Giat bekerja_Bekerja keras_Karsa_Introvert_jasad",
                    },
                    {
                        name: "Firaasah",
                        nama: "berfirasat",
                        score: 40,
                        groupId:
                            "Suka berpikir imajinatif_Berpikir_Cipta_Introvert_jasad",
                    },
                    {
                        name: "Nubl",
                        nama: "cerdik",
                        score: 30,
                        groupId:
                            "Suka berpikir imajinatif_Berpikir_Cipta_Introvert_jasad",
                    },
                    {
                        name: "Husnuzhan",
                        nama: "berprasangka baik",
                        score: 45,
                        groupId:
                            "Suka berpikir positif_Berpikir_Cipta_Introvert_jasad",
                    },
                    {
                        name: "Dzakaa’",
                        nama: "cerdas",
                        score: 30,
                        groupId:
                            "Suka berpikir analitis_Berpikir_Cipta_Introvert_jasad",
                    },
                    {
                        name: "Hikmah",
                        nama: "ahli hikmah",
                        score: 30,
                        groupId:
                            "Suka berpikir analitis_Berpikir_Cipta_Introvert_jasad",
                    },
                    {
                        name: "Shidq",
                        nama: "jujur",
                        score: 45,
                        groupId:
                            "Suka apa adanya_Berperasaan_Rasa_Introvert_jasad",
                    },
                    {
                        name: "‘iffah",
                        nama: "menjaga diri",
                        score: 50,
                        groupId: "Pendiam_Berperasaan_Rasa_Introvert_jasad",
                    },
                    {
                        name: "Shamt",
                        nama: "pendiam",
                        score: 40,
                        groupId: "Pendiam_Berperasaan_Rasa_Introvert_jasad",
                    },
                    {
                        name: "Hayaa’",
                        nama: "pemalu",
                        score: 50,
                        groupId:
                            "Suka merendah_Berperasaan_Rasa_Introvert_jasad",
                    },
                    {
                        name: "Qanaa'ah",
                        nama: "sederhana",
                        score: 40,
                        groupId:
                            "Suka merendah_Berperasaan_Rasa_Introvert_jasad",
                    },
                    {
                        name: "Shabr",
                        nama: "penyabar",
                        score: 35,
                        groupId:
                            "Suka merendah_Berperasaan_Rasa_Introvert_jasad",
                    },
                    {
                        name: "Syajaa’ah",
                        nama: "pemberani",
                        score: 50,
                        groupId:
                            "Suka menguasai_Mempengaruhi_Karsa_Extrovert_jasad",
                    },
                    {
                        name: "Ghairah",
                        nama: "pencemburu",
                        score: 45,
                        groupId:
                            "Suka menguasai_Mempengaruhi_Karsa_Extrovert_jasad",
                    },
                    {
                        name: "Munaafasah",
                        nama: "kompetitif",
                        score: 35,
                        groupId:
                            "Suka menguasai_Mempengaruhi_Karsa_Extrovert_jasad",
                    },
                    {
                        name: "Nashiihah",
                        nama: "penasehat",
                        score: 45,
                        groupId:
                            "Suka memotivasi_Mempengaruhi_Karsa_Extrovert_jasad",
                    },
                    {
                        name: "Fashaahah",
                        nama: "komunikatif",
                        score: 35,
                        groupId:
                            "Suka memotivasi_Mempengaruhi_Karsa_Extrovert_jasad",
                    },
                    {
                        name: "Nushrah",
                        nama: "menolong",
                        score: 35,
                        groupId:
                            "Suka menolong_Mempengaruhi_Karsa_Extrovert_jasad",
                    },
                    {
                        name: "Juud",
                        nama: "dermawan",
                        score: 45,
                        groupId:
                            "Suka menolong_Mempengaruhi_Karsa_Extrovert_jasad",
                    },
                    {
                        name: "Ta'aawun",
                        nama: "bekerjaasama",
                        score: 30,
                        groupId:
                            "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_jasad",
                    },
                    {
                        name: "Ulfah",
                        nama: "bersatu",
                        score: 40,
                        groupId:
                            "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_jasad",
                    },
                    {
                        name: "‘adaalah",
                        nama: "adil",
                        score: 30,
                        groupId:
                            "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_jasad",
                    },
                    {
                        name: "Wafaa'",
                        nama: "menepati janji",
                        score: 45,
                        groupId:
                            "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_jasad",
                    },
                    {
                        name: "Muzaah",
                        nama: "humoris",
                        score: 40,
                        groupId:
                            "Suka membuat hubungan baru_Bekerjasama_Cipta_Extrovert_jasad",
                    },
                    {
                        name: "Basyaasyah",
                        nama: "berseri-seri",
                        score: 50,
                        groupId:
                            "Suka membuat hubungan baru_Bekerjasama_Cipta_Extrovert_jasad",
                    },
                    {
                        name: "Rifq",
                        nama: "lemah lembut",
                        score: 50,
                        groupId:
                            "Suka mengeratkan hubungan yang sudah ada_Bekerjasama_Cipta_Extrovert_jasad",
                    },
                    {
                        name: "Rahmah",
                        nama: "berbelas kasih",
                        score: 45,
                        groupId:
                            "Suka mengeratkan hubungan yang sudah ada_Bekerjasama_Cipta_Extrovert_jasad",
                    },
                    {
                        name: "Mahabbah",
                        nama: "penuh cinta",
                        score: 30,
                        groupId:
                            "Suka melayani dengan cara memberi_Melayani_Rasa_Extrovert_jasad",
                    },
                    {
                        name: "Itsaar",
                        nama: "melayani",
                        score: 35,
                        groupId:
                            "Suka melayani dengan cara memberi_Melayani_Rasa_Extrovert_jasad",
                    },
                    {
                        name: "Kitmaanus sirr",
                        nama: "penjaga rahasia",
                        score: 50,
                        groupId:
                            "Suka melayani dengan cara menjaga_Melayani_Rasa_Extrovert_jasad",
                    },
                    {
                        name: "Satr",
                        nama: "menutup aib",
                        score: 30,
                        groupId:
                            "Suka melayani dengan cara menjaga_Melayani_Rasa_Extrovert_jasad",
                    },
                    {
                        name: "Amaanah",
                        nama: "bertanggung jawab",
                        score: 35,
                        groupId:
                            "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_jasad",
                    },
                    {
                        name: "Anaah",
                        nama: "tidak tergesa",
                        score: 40,
                        groupId:
                            "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_jasad",
                    },
                    {
                        name: "Hilm",
                        nama: "santun",
                        score: 35,
                        groupId:
                            "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_jasad",
                    },
                    {
                        name: "Tawaadhu'",
                        nama: "rendah hati",
                        score: 35,
                        groupId:
                            "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_jasad",
                    },
                ],
            ];

            // 1. Basic Lists
            const ruhList = rawDataGroups[0].map((item, index) => ({
                name: item.nama,
                value: item.score,
                itemStyle: { color: getColor("blue", index) },
            }));

            const jasadList = rawDataGroups[1].map((item, index) => ({
                name: item.nama,
                value: item.score,
                itemStyle: { color: getColor("brown", index) },
            }));

            // 2. Combined List with Sorting for Karsa/Cipta/Rasa
            const combinedList = rawDataGroups[0]
                .map((item, index) => {
                    const jasadItem = rawDataGroups[1].find(
                        (j) => j.name === item.name,
                    ) || { score: 0 };
                    const mergedValue = item.score + jasadItem.score;
                    const groupString = item.groupId;
                    let itemColor = "#ccc";
                    let sortIndex = 99;
                    let jiwa = "";

                    if (groupString.includes("Karsa")) {
                        jiwa = "karsa";
                        itemColor = getColor("red", index);
                        sortIndex = 1;
                    } else if (groupString.includes("Cipta")) {
                        jiwa = "cipta";
                        itemColor = getColor("yellow", index);
                        sortIndex = 2;
                    } else if (groupString.includes("Rasa")) {
                        jiwa = "rasa";
                        itemColor = getColor("green", index);
                        sortIndex = 3;
                    }

                    return {
                        name: item.nama,
                        value: mergedValue,
                        itemStyle: { color: itemColor },
                        sortIndex: sortIndex,
                        parent: groupString,
                        jiwa,
                    };
                })

                .sort((a, b) => a.sortIndex - b.sortIndex);

            // 3. Aggregate Data for Outer Pie (3 Jiwa)
            let ammarahSum = 0;
            let lawwamahSum = 0;
            let muthmainnahSum = 0;

            // Calculate counts to locate MarkArea positions for Page 3
            let countKarsa = 0;
            let countCipta = 0;
            let countRasa = 0;

            combinedList.forEach((item) => {
                if (item.sortIndex === 1) {
                    ammarahSum += item.value;
                    countKarsa++;
                }
                if (item.sortIndex === 2) {
                    lawwamahSum += item.value;
                    countCipta++;
                }
                if (item.sortIndex === 3) {
                    muthmainnahSum += item.value;
                    countRasa++;
                }
            });

            // Data for the Outer Ring
            const jiwaOuterData = [
                {
                    value: ammarahSum,
                    name: "Jiwa Ammarah\n(Karsa)",
                    itemStyle: { color: "#ef5350" },
                },
                {
                    value: lawwamahSum,
                    name: "Jiwa Lawwamah\n(Cipta)",
                    itemStyle: { color: "#fdd835" },
                },
                {
                    value: muthmainnahSum,
                    name: "Jiwa Muthmainnah\n(Rasa)",
                    itemStyle: { color: "#66bb6a" },
                },
            ];

            // ==========================================
            // 2. CHART GENERATOR FUNCTIONS
            // ==========================================
            const isMobile = () => window.innerWidth < 768;

            const baseSeriesConfig = {
                type: "pie",
                emphasis: {
                    itemStyle: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: "rgba(0, 0, 0, 0.5)",
                    },
                },
                label: {
                    show: true,
                    position: "outside",
                    formatter: "{b}",
                    fontSize: 10,
                },
                labelLine: { show: true, length: 15 },
            };

            // PAGE 1: Ruh dan Jasad
            function getSplitViewOption() {
                const mobile = isMobile();
                return {
                    title: [
                        {
                            text: "Dimensi Ruh (Biru)",
                            left: mobile ? "50%" : "25%",
                            top: mobile ? "5%" : "15%",
                            textAlign: "center",
                        },
                        {
                            text: "Dimensi Jasad (Coklat)",
                            left: mobile ? "50%" : "75%",
                            top: mobile ? "55%" : "15%",
                            textAlign: "center",
                        },
                    ],
                    tooltip: { trigger: "item", formatter: "{b}: {c}" },
                    grid: { show: false },
                    series: [
                        {
                            ...baseSeriesConfig,
                            id: "ruh",
                            name: "Ruh",
                            radius: ["30%", "50%"],
                            center: mobile ? ["50%", "30%"] : ["25%", "55%"],
                            data: ruhList,
                            universalTransition: { enabled: true },
                        },
                        {
                            ...baseSeriesConfig,
                            id: "jasad",
                            name: "Jasad",
                            radius: ["30%", "50%"],
                            center: mobile ? ["50%", "75%"] : ["75%", "55%"],
                            data: jasadList,
                            universalTransition: { enabled: true },
                        },
                    ],
                    animationDurationUpdate: 1000,
                };
            }

            // PAGE 2: 3 Jiwa (Nested Pie)
            function getJiwaViewOption() {
                const mobile = isMobile();
                return {
                    title: {
                        text: "3 Jiwa (Nested Pie)",
                        left: "center",
                        top: "2%",
                        textStyle: { fontSize: 18 },
                    },
                    tooltip: { trigger: "item", formatter: "{b}: {c}" },
                    series: [
                        // INNER RING: Detailed Attributes
                        {
                            ...baseSeriesConfig,
                            id: "combined", // Keep ID to transition from Page 3
                            name: "Detail",
                            radius: ["0%", "72%"], // Inner circle
                            center: ["50%", "55%"],
                            data: combinedList,
                            label: {
                                show: true,
                                position: "inner",
                                fontSize: 9,
                                formatter: "{b}",
                            },
                            labelLine: { show: false },
                            universalTransition: {
                                enabled: true,
                                seriesKey: ["ruh", "jasad"],
                            },
                        },
                        // OUTER RING: 3 Jiwa Groups
                        {
                            type: "pie",
                            name: "Jiwa Group",
                            radius: ["75%", "80%"], // Outer Ring
                            center: ["50%", "55%"],
                            data: jiwaOuterData,
                            label: {
                                show: true,
                                position: "outside",
                                formatter: "{b}\n{d}%",
                                fontWeight: "bold",
                                fontSize: 12,
                            },
                            itemStyle: {
                                borderRadius: 4,
                                borderColor: "#fff",
                                borderWidth: 2,
                            },
                        },
                    ],
                    animationDurationUpdate: 1000,
                };
            }

            // PAGE 3: Kecerdasan (Grouped Bar with Aqidah)
            function getKecerdasanViewOption() {
                // Calculate indices for markArea
                // combinedList is sorted: Karsa (0 to countKarsa-1), Cipta (countKarsa to countKarsa+countCipta-1), etc.
                const categories = combinedList.map((i) => i.name);

                return {
                    title: {
                        text: "Kecerdasan",
                        left: "center",
                        top: "0",
                        textStyle: { fontSize: 18 },
                    },
                    tooltip: { trigger: "item", formatter: "{b}: {c}" },
                    grid: {
                        left: "3%",
                        right: "4%",
                        bottom: "10%",
                        containLabel: true,
                    },
                    xAxis: {
                        type: "category",
                        data: categories,
                        axisLabel: { interval: 0, rotate: 45, fontSize: 10 },
                        z: 10, // Ensure text is readable
                    },
                    yAxis: { type: "value" },
                    series: [
                        {
                            type: "bar",
                            id: "combined",
                            name: "Nilai",
                            data: combinedList,
                            universalTransition: {
                                enabled: true,
                                seriesKey: ["ruh", "jasad"],
                            },
                            itemStyle: { borderRadius: [5, 5, 0, 0] },
                            label: {
                                show: true,
                                position: "top",
                                fontSize: 10,
                            },
                            // Add MarkAreas for Backgrounds
                            markArea: {
                                silent: true, // Not clickable
                                itemStyle: { opacity: 0.15 },
                                label: {
                                    position: "top",
                                    color: "#333",
                                    fontSize: 14,
                                    fontWeight: "bold",
                                },
                                data: [
                                    [
                                        {
                                            name: "Fisik (PQ)\n(Karsa)",
                                            xAxis: 0,
                                            itemStyle: { color: "red" },
                                        },
                                        { xAxis: countKarsa - 1 },
                                    ],
                                    [
                                        {
                                            name: "Akal (IQ)\n(Cipta)",
                                            xAxis: countKarsa,
                                            itemStyle: { color: "yellow" },
                                        },
                                        { xAxis: countKarsa + countCipta - 1 },
                                    ],
                                    [
                                        {
                                            name: "Hati (EQ)\n(Rasa)",
                                            xAxis: countKarsa + countCipta,
                                            itemStyle: { color: "green" },
                                        },
                                        { xAxis: categories.length - 1 },
                                    ],
                                ],
                            },
                            // Add Aqidah Line covering all
                            markLine: {
                                symbol: ["none", "none"],
                                label: {
                                    show: true,
                                    position: "insideMiddleBottom",
                                    formatter: "{b}",
                                    backgroundColor: "#4ade80",
                                    color: "#fff",
                                    padding: [4, 8],
                                    margin: [0, -10],
                                    borderRadius: 4,
                                },
                                lineStyle: {
                                    color: "#22c55e",
                                    width: 4,
                                    type: "solid",
                                },
                                data: [
                                    { yAxis: 20, name: "Aqidah" },
                                    { yAxis: 40, name: "Ibadah" },
                                    { yAxis: 60, name: "Akhlak" },
                                    { yAxis: 100, name: "Bakat" },
                                ],
                            },
                        },
                    ],
                    animationDurationUpdate: 1000,
                };
            }

            function getTujuanHidupViewOption() {
                // Calculate indices for markArea
                // combinedList is sorted: Karsa (0 to countKarsa-1), Cipta (countKarsa to countKarsa+countCipta-1), etc.
                const categories = combinedList.map((i) => i.name);

                return {
                    title: {
                        text: "Tujuan Hidup",
                        left: "center",
                        top: "0",
                        textStyle: { fontSize: 18 },
                    },
                    tooltip: { trigger: "item", formatter: "{b}: {c}" },
                    grid: {
                        left: "3%",
                        right: "4%",
                        bottom: "10%",
                        containLabel: true,
                    },
                    xAxis: {
                        type: "category",
                        data: categories,
                        axisLabel: { interval: 0, rotate: 45, fontSize: 10 },
                        z: 10, // Ensure text is readable
                    },
                    yAxis: { type: "value" },
                    series: [
                        {
                            type: "bar",
                            id: "combined",
                            name: "Nilai",
                            data: combinedList,
                            universalTransition: {
                                enabled: true,
                                seriesKey: ["ruh", "jasad"],
                            },
                            itemStyle: { borderRadius: [5, 5, 0, 0] },
                            label: {
                                show: true,
                                position: "top",
                                fontSize: 10,
                            },
                            // Add MarkAreas for Backgrounds
                            markArea: {
                                silent: true, // Not clickable
                                itemStyle: { opacity: 0.15 },
                                label: {
                                    position: "top",
                                    color: "#333",
                                    fontSize: 14,
                                    fontWeight: "bold",
                                },
                                data: [
                                    [
                                        {
                                            name: "Fisik (PQ)\n(Karsa)",
                                            xAxis: 0,
                                            itemStyle: { color: "red" },
                                        },
                                        { xAxis: countKarsa - 1 },
                                    ],
                                    [
                                        {
                                            name: "Akal (IQ)\n(Cipta)",
                                            xAxis: countKarsa,
                                            itemStyle: { color: "yellow" },
                                        },
                                        { xAxis: countKarsa + countCipta - 1 },
                                    ],
                                    [
                                        {
                                            name: "Hati (EQ)\n(Rasa)",
                                            xAxis: countKarsa + countCipta,
                                            itemStyle: { color: "green" },
                                        },
                                        { xAxis: categories.length - 1 },
                                    ],
                                ],
                            },
                            // Add Aqidah Line covering all
                            markLine: {
                                symbol: ["none", "none"],
                                label: {
                                    show: true,
                                    position: "insideMiddleBottom",
                                    formatter: "{b}",
                                    backgroundColor: "#4ade80",
                                    color: "#fff",
                                    padding: [4, 8],
                                    margin: [0, -10],
                                    borderRadius: 4,
                                },
                                lineStyle: {
                                    color: "#22c55e",
                                    width: 4,
                                    type: "solid",
                                },
                                data: [
                                    { yAxis: 50, name: "Sholih" },
                                    { yAxis: 100, name: "Muslih" },
                                ],
                                animation: true,
                            },
                        },
                    ],
                    animationDurationUpdate: 1000,
                };
            }

            function getFitrahKarakterViewOption() {
                // Calculate indices for markArea
                // combinedList is sorted: Karsa (0 to countKarsa-1), Cipta (countKarsa to countKarsa+countCipta-1), etc.
                const categories = combinedList.map((i) => i.name);

                return {
                    title: {
                        text: "Tujuan Hidup",
                        left: "center",
                        top: "0",
                        textStyle: { fontSize: 18 },
                    },
                    tooltip: { trigger: "item", formatter: "{b}: {c}" },
                    grid: {
                        left: "3%",
                        right: "4%",
                        bottom: "10%",
                        containLabel: true,
                    },
                    xAxis: {
                        type: "category",
                        data: categories,
                        axisLabel: { interval: 0, rotate: 45, fontSize: 10 },
                        z: 10, // Ensure text is readable
                    },
                    yAxis: { type: "value" },
                    series: [
                        {
                            type: "bar",
                            id: "combined",
                            name: "Nilai",
                            stack: "kar",

                            data: combinedList.map((item) => ({
                                ...item,
                                value: item.value / 2,
                            })),
                            universalTransition: {
                                enabled: true,
                                seriesKey: ["ruh", "jasad"],
                            },
                            itemStyle: { borderRadius: [5, 5, 0, 0] },
                            label: {
                                show: true,
                                position: "top",
                                fontSize: 10,
                            },
                            markArea: {
                                silent: true, // Not clickable
                                itemStyle: { opacity: 0.15 },
                                label: {
                                    position: "insideTopRight",
                                    color: "#333",
                                    fontSize: 14,
                                    fontWeight: "bold",
                                    align: "left",
                                },
                                data: [
                                    [
                                        {
                                            name: "Karakter",
                                            yAxis: 0,
                                            itemStyle: {
                                                color: "brown",
                                            },
                                        },
                                        { yAxis: 50 },
                                    ],
                                    [
                                        {
                                            name: "Fitrah",
                                            yAxis: 50,
                                            itemStyle: { color: "blue" },
                                        },
                                        { yAxis: 100 },
                                    ],
                                ],
                            },
                        },
                        {
                            type: "bar",
                            id: "fitrah",
                            name: "Nilai",
                            stack: "kar",
                            title: "FITRAH",
                            data: combinedList.map((item) => ({
                                ...item,
                                value: item.value / 2,
                                label: {
                                    // position: "inside",
                                    formatter: `${item.value}`,
                                },
                                itemStyle: {
                                    ...item.itemStyle,
                                    opacity: 0.5,
                                    color: "#fff",
                                },
                            })),
                            universalTransition: {
                                enabled: true,
                                // seriesKey: ["ruh", "jasad"],
                            },
                            itemStyle: { borderRadius: [5, 5, 0, 0] },
                            label: {
                                show: true,
                                position: "top",
                                fontSize: 10,
                            },
                            // Add MarkAreas for Backgrounds
                            markArea: {
                                silent: true, // Not clickable
                                itemStyle: { opacity: 0.15 },
                                label: {
                                    position: "top",
                                    color: "#333",
                                    fontSize: 14,
                                    fontWeight: "bold",
                                },
                                data: [
                                    [
                                        {
                                            name: "Fisik (PQ)\n(Karsa)",
                                            xAxis: 0,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: countKarsa - 1 },
                                    ],
                                    [
                                        {
                                            name: "Akal (IQ)\n(Cipta)",
                                            xAxis: countKarsa,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: countKarsa + countCipta - 1 },
                                    ],
                                    [
                                        {
                                            name: "Hati (EQ)\n(Rasa)",
                                            xAxis: countKarsa + countCipta,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: categories.length - 1 },
                                    ],
                                ],
                            },
                            // Add Aqidah Line covering all
                            markLine: {
                                symbol: ["none", "none"],
                                label: {
                                    show: true,
                                    position: "insideMiddleBottom",
                                    formatter: "{b}",
                                    backgroundColor: "#4ade80",
                                    color: "#fff",
                                    padding: [4, 8],
                                    margin: [0, -10],
                                    borderRadius: 4,
                                },
                                lineStyle: {
                                    color: "#22c55e",
                                    width: 4,
                                    type: "solid",
                                },
                                data: [
                                    { yAxis: 50, name: "Sholih" },
                                    { yAxis: 100, name: "Muslih" },
                                ],
                                animation: false,
                            },
                        },
                    ],
                    animationDurationUpdate: 1000,
                };
            }

            function getThufulahViewOption() {
                // Calculate indices for markArea
                // combinedList is sorted: Karsa (0 to countKarsa-1), Cipta (countKarsa to countKarsa+countCipta-1), etc.
                const categories = combinedList.map((i) => i.name);
                console.log(combinedList);

                const valueAdjustment = {
                    rasa: 0.4,
                    cipta: 0.2,
                    karsa: 0.2,
                };
                const phaseData = combinedList.map((item) => ({
                    ...item,
                    value: Math.round(item.value * valueAdjustment[item.jiwa]),
                    caps: item.value * (1 - valueAdjustment[item.jiwa]),
                    ori: item.value,
                }));
                const karakterLine = Math.max(
                    ...phaseData.map((item) => item.value),
                );

                console.log(phaseData);
                console.log(karakterLine);

                return {
                    title: {
                        text: "Tujuan Hidup",
                        left: "center",
                        top: "0",
                        textStyle: { fontSize: 18 },
                    },
                    tooltip: { trigger: "item", formatter: "{b}: {c}" },
                    grid: {
                        left: "3%",
                        right: "4%",
                        bottom: "10%",
                        containLabel: true,
                    },
                    xAxis: {
                        type: "category",
                        data: categories,
                        axisLabel: { interval: 0, rotate: 45, fontSize: 10 },
                        z: 10, // Ensure text is readable
                    },
                    yAxis: { type: "value" },
                    series: [
                        {
                            type: "bar",
                            id: "combined",
                            name: "Nilai",
                            stack: "kar",

                            data: phaseData,
                            universalTransition: {
                                enabled: true,
                                seriesKey: ["ruh", "jasad"],
                            },
                            itemStyle: { borderRadius: [5, 5, 0, 0] },
                            label: {
                                show: true,
                                position: "top",
                                fontSize: 10,
                            },
                            markArea: {
                                silent: true, // Not clickable
                                itemStyle: { opacity: 0.15 },
                                label: {
                                    position: "insideTopRight",
                                    color: "#333",
                                    fontSize: 14,
                                    fontWeight: "bold",
                                    align: "left",
                                },
                                data: [
                                    [
                                        {
                                            name: "Karakter",
                                            yAxis: 0,
                                            itemStyle: {
                                                color: "brown",
                                            },
                                        },
                                        { yAxis: karakterLine },
                                    ],
                                    [
                                        {
                                            name: "Fitrah",
                                            yAxis: karakterLine,
                                            itemStyle: { color: "blue" },
                                        },
                                        { yAxis: 100 },
                                    ],
                                ],
                            },
                        },
                        {
                            type: "bar",
                            id: "fitrah",
                            name: "Nilai",
                            stack: "kar",
                            title: "FITRAH",
                            data: phaseData.map((item) => ({
                                ...item,
                                value: item.caps,
                                label: {
                                    // position: "inside",
                                    formatter: `${item.ori}`,
                                },
                                itemStyle: {
                                    ...item.itemStyle,
                                    opacity: 0.5,
                                    color: "#fff",
                                },
                            })),
                            universalTransition: {
                                enabled: true,
                                // seriesKey: ["ruh", "jasad"],
                            },
                            itemStyle: { borderRadius: [5, 5, 0, 0] },
                            label: {
                                show: true,
                                position: "top",
                                fontSize: 10,
                            },
                            // Add MarkAreas for Backgrounds
                            markArea: {
                                silent: true, // Not clickable
                                itemStyle: { opacity: 0.15 },
                                label: {
                                    position: "top",
                                    color: "#333",
                                    fontSize: 14,
                                    fontWeight: "bold",
                                },
                                data: [
                                    [
                                        {
                                            name: "Fisik (PQ)\n(Karsa)",
                                            xAxis: 0,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: countKarsa - 1 },
                                    ],
                                    [
                                        {
                                            name: "Akal (IQ)\n(Cipta)",
                                            xAxis: countKarsa,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: countKarsa + countCipta - 1 },
                                    ],
                                    [
                                        {
                                            name: "Hati (EQ)\n(Rasa)",
                                            xAxis: countKarsa + countCipta,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: categories.length - 1 },
                                    ],
                                ],
                            },
                            // Add Aqidah Line covering all
                            markLine: {
                                symbol: ["none", "none"],
                                label: {
                                    show: true,
                                    position: "insideMiddleBottom",
                                    formatter: "{b}",
                                    backgroundColor: "#4ade80",
                                    color: "#fff",
                                    padding: [4, 8],
                                    margin: [0, -10],
                                    borderRadius: 4,
                                },
                                lineStyle: {
                                    color: "#22c55e",
                                    width: 4,
                                    type: "solid",
                                },
                                data: [
                                    { yAxis: 50, name: "Sholih" },
                                    { yAxis: 100, name: "Muslih" },
                                ],
                                animation: false,
                            },
                        },
                    ],
                    animationDurationUpdate: 1000,
                };
            }
            function getTamyizViewOption() {
                // Calculate indices for markArea
                // combinedList is sorted: Karsa (0 to countKarsa-1), Cipta (countKarsa to countKarsa+countCipta-1), etc.
                const categories = combinedList.map((i) => i.name);
                console.log(combinedList);

                const valueAdjustment = {
                    rasa: 0.6,
                    cipta: 0.7,
                    karsa: 0.5,
                };
                const phaseData = combinedList.map((item) => ({
                    ...item,
                    value: Math.round(item.value * valueAdjustment[item.jiwa]),
                    caps: item.value * (1 - valueAdjustment[item.jiwa]),
                    ori: item.value,
                }));
                const karakterLine = Math.max(
                    ...phaseData.map((item) => item.value),
                );

                console.log(phaseData);
                console.log(karakterLine);

                return {
                    title: {
                        text: "Tujuan Hidup",
                        left: "center",
                        top: "0",
                        textStyle: { fontSize: 18 },
                    },
                    tooltip: { trigger: "item", formatter: "{b}: {c}" },
                    grid: {
                        left: "3%",
                        right: "4%",
                        bottom: "10%",
                        containLabel: true,
                    },
                    xAxis: {
                        type: "category",
                        data: categories,
                        axisLabel: { interval: 0, rotate: 45, fontSize: 10 },
                        z: 10, // Ensure text is readable
                    },
                    yAxis: { type: "value" },
                    series: [
                        {
                            type: "bar",
                            id: "combined",
                            name: "Nilai",
                            stack: "kar",

                            data: phaseData,
                            universalTransition: {
                                enabled: true,
                                seriesKey: ["ruh", "jasad"],
                            },
                            itemStyle: { borderRadius: [5, 5, 0, 0] },
                            label: {
                                show: true,
                                position: "top",
                                fontSize: 10,
                            },
                            markArea: {
                                silent: true, // Not clickable
                                itemStyle: { opacity: 0.15 },
                                label: {
                                    position: "insideTopRight",
                                    color: "#333",
                                    fontSize: 14,
                                    fontWeight: "bold",
                                    align: "left",
                                },
                                data: [
                                    [
                                        {
                                            name: "Karakter",
                                            yAxis: 0,
                                            itemStyle: {
                                                color: "brown",
                                            },
                                        },
                                        { yAxis: karakterLine },
                                    ],
                                    [
                                        {
                                            name: "Fitrah",
                                            yAxis: karakterLine,
                                            itemStyle: { color: "blue" },
                                        },
                                        { yAxis: 100 },
                                    ],
                                ],
                            },
                        },
                        {
                            type: "bar",
                            id: "fitrah",
                            name: "Nilai",
                            stack: "kar",
                            title: "FITRAH",
                            data: phaseData.map((item) => ({
                                ...item,
                                value: item.caps,
                                label: {
                                    // position: "inside",
                                    formatter: `${item.ori}`,
                                },
                                itemStyle: {
                                    ...item.itemStyle,
                                    opacity: 0.5,
                                    color: "#fff",
                                },
                            })),
                            universalTransition: {
                                enabled: true,
                                // seriesKey: ["ruh", "jasad"],
                            },
                            itemStyle: { borderRadius: [5, 5, 0, 0] },
                            label: {
                                show: true,
                                position: "top",
                                fontSize: 10,
                            },
                            // Add MarkAreas for Backgrounds
                            markArea: {
                                silent: true, // Not clickable
                                itemStyle: { opacity: 0.15 },
                                label: {
                                    position: "top",
                                    color: "#333",
                                    fontSize: 14,
                                    fontWeight: "bold",
                                },
                                data: [
                                    [
                                        {
                                            name: "Fisik (PQ)\n(Karsa)",
                                            xAxis: 0,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: countKarsa - 1 },
                                    ],
                                    [
                                        {
                                            name: "Akal (IQ)\n(Cipta)",
                                            xAxis: countKarsa,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: countKarsa + countCipta - 1 },
                                    ],
                                    [
                                        {
                                            name: "Hati (EQ)\n(Rasa)",
                                            xAxis: countKarsa + countCipta,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: categories.length - 1 },
                                    ],
                                ],
                            },
                            // Add Aqidah Line covering all
                            markLine: {
                                symbol: ["none", "none"],
                                label: {
                                    show: true,
                                    position: "insideMiddleBottom",
                                    formatter: "{b}",
                                    backgroundColor: "#4ade80",
                                    color: "#fff",
                                    padding: [4, 8],
                                    margin: [0, -10],
                                    borderRadius: 4,
                                },
                                lineStyle: {
                                    color: "#22c55e",
                                    width: 4,
                                    type: "solid",
                                },
                                data: [
                                    { yAxis: 50, name: "Sholih" },
                                    { yAxis: 100, name: "Muslih" },
                                ],
                                animation: false,
                            },
                        },
                    ],
                    animationDurationUpdate: 1000,
                };
            }
            function getMurahaqahViewOption() {
                // Calculate indices for markArea
                // combinedList is sorted: Karsa (0 to countKarsa-1), Cipta (countKarsa to countKarsa+countCipta-1), etc.
                const categories = combinedList.map((i) => i.name);
                console.log(combinedList);

                const valueAdjustment = {
                    rasa: 0.8,
                    cipta: 0.8,
                    karsa: 0.8,
                };
                const phaseData = combinedList.map((item) => ({
                    ...item,
                    value: Math.round(item.value * valueAdjustment[item.jiwa]),
                    caps: item.value * (1 - valueAdjustment[item.jiwa]),
                    ori: item.value,
                }));
                const karakterLine = Math.max(
                    ...phaseData.map((item) => item.value),
                );

                console.log(phaseData);
                console.log(karakterLine);

                return {
                    title: {
                        text: "Tujuan Hidup",
                        left: "center",
                        top: "0",
                        textStyle: { fontSize: 18 },
                    },
                    tooltip: { trigger: "item", formatter: "{b}: {c}" },
                    grid: {
                        left: "3%",
                        right: "4%",
                        bottom: "10%",
                        containLabel: true,
                    },
                    xAxis: {
                        type: "category",
                        data: categories,
                        axisLabel: { interval: 0, rotate: 45, fontSize: 10 },
                        z: 10, // Ensure text is readable
                    },
                    yAxis: { type: "value" },
                    series: [
                        {
                            type: "bar",
                            id: "combined",
                            name: "Nilai",
                            stack: "kar",

                            data: phaseData,
                            universalTransition: {
                                enabled: true,
                                seriesKey: ["ruh", "jasad"],
                            },
                            itemStyle: { borderRadius: [5, 5, 0, 0] },
                            label: {
                                show: true,
                                position: "top",
                                fontSize: 10,
                            },
                            markArea: {
                                silent: true, // Not clickable
                                itemStyle: { opacity: 0.15 },
                                label: {
                                    position: "insideTopRight",
                                    color: "#333",
                                    fontSize: 14,
                                    fontWeight: "bold",
                                    align: "left",
                                },
                                data: [
                                    [
                                        {
                                            name: "Karakter",
                                            yAxis: 0,
                                            itemStyle: {
                                                color: "brown",
                                            },
                                        },
                                        { yAxis: karakterLine },
                                    ],
                                    [
                                        {
                                            name: "Fitrah",
                                            yAxis: karakterLine,
                                            itemStyle: { color: "blue" },
                                        },
                                        { yAxis: 100 },
                                    ],
                                ],
                            },
                        },
                        {
                            type: "bar",
                            id: "fitrah",
                            name: "Nilai",
                            stack: "kar",
                            title: "FITRAH",
                            data: phaseData.map((item) => ({
                                ...item,
                                value: item.caps,
                                label: {
                                    // position: "inside",
                                    formatter: `${item.ori}`,
                                },
                                itemStyle: {
                                    ...item.itemStyle,
                                    opacity: 0.5,
                                    color: "#fff",
                                },
                            })),
                            universalTransition: {
                                enabled: true,
                                // seriesKey: ["ruh", "jasad"],
                            },
                            itemStyle: { borderRadius: [5, 5, 0, 0] },
                            label: {
                                show: true,
                                position: "top",
                                fontSize: 10,
                            },
                            // Add MarkAreas for Backgrounds
                            markArea: {
                                silent: true, // Not clickable
                                itemStyle: { opacity: 0.15 },
                                label: {
                                    position: "top",
                                    color: "#333",
                                    fontSize: 14,
                                    fontWeight: "bold",
                                },
                                data: [
                                    [
                                        {
                                            name: "Fisik (PQ)\n(Karsa)",
                                            xAxis: 0,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: countKarsa - 1 },
                                    ],
                                    [
                                        {
                                            name: "Akal (IQ)\n(Cipta)",
                                            xAxis: countKarsa,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: countKarsa + countCipta - 1 },
                                    ],
                                    [
                                        {
                                            name: "Hati (EQ)\n(Rasa)",
                                            xAxis: countKarsa + countCipta,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: categories.length - 1 },
                                    ],
                                ],
                            },
                            // Add Aqidah Line covering all
                            markLine: {
                                symbol: ["none", "none"],
                                label: {
                                    show: true,
                                    position: "insideMiddleBottom",
                                    formatter: "{b}",
                                    backgroundColor: "#4ade80",
                                    color: "#fff",
                                    padding: [4, 8],
                                    margin: [0, -10],
                                    borderRadius: 4,
                                },
                                lineStyle: {
                                    color: "#22c55e",
                                    width: 4,
                                    type: "solid",
                                },
                                data: [
                                    { yAxis: 50, name: "Sholih" },
                                    { yAxis: 100, name: "Muslih" },
                                ],
                                animation: false,
                            },
                        },
                    ],
                    animationDurationUpdate: 1000,
                };
            }
            function getSyababViewOption() {
                // Calculate indices for markArea
                // combinedList is sorted: Karsa (0 to countKarsa-1), Cipta (countKarsa to countKarsa+countCipta-1), etc.
                const categories = combinedList.map((i) => i.name);
                console.log(combinedList);

                const valueAdjustment = {
                    rasa: 1,
                    cipta: 1,
                    karsa: 1,
                };
                const phaseData = combinedList.map((item) => ({
                    ...item,
                    value: Math.round(item.value * valueAdjustment[item.jiwa]),
                    caps: item.value * (1 - valueAdjustment[item.jiwa]),
                    ori: item.value,
                }));
                const karakterLine = Math.max(
                    ...phaseData.map((item) => item.value),
                );

                console.log(phaseData);
                console.log(karakterLine);

                return {
                    title: {
                        text: "Tujuan Hidup",
                        left: "center",
                        top: "0",
                        textStyle: { fontSize: 18 },
                    },
                    tooltip: { trigger: "item", formatter: "{b}: {c}" },
                    grid: {
                        left: "3%",
                        right: "4%",
                        bottom: "10%",
                        containLabel: true,
                    },
                    xAxis: {
                        type: "category",
                        data: categories,
                        axisLabel: { interval: 0, rotate: 45, fontSize: 10 },
                        z: 10, // Ensure text is readable
                    },
                    yAxis: { type: "value" },
                    series: [
                        {
                            type: "bar",
                            id: "combined",
                            name: "Nilai",
                            stack: "kar",

                            data: phaseData,
                            universalTransition: {
                                enabled: true,
                                seriesKey: ["ruh", "jasad"],
                            },
                            itemStyle: { borderRadius: [5, 5, 0, 0] },
                            label: {
                                show: true,
                                position: "top",
                                fontSize: 10,
                            },
                            markArea: {
                                silent: true, // Not clickable
                                itemStyle: { opacity: 0.15 },
                                label: {
                                    position: "insideTopRight",
                                    color: "#333",
                                    fontSize: 14,
                                    fontWeight: "bold",
                                    align: "left",
                                },
                                data: [
                                    [
                                        {
                                            name: "Karakter",
                                            yAxis: 0,
                                            itemStyle: {
                                                color: "brown",
                                            },
                                        },
                                        { yAxis: karakterLine },
                                    ],
                                ],
                            },
                        },
                        {
                            type: "bar",
                            id: "fitrah",
                            name: "Nilai",
                            stack: "kar",
                            title: "FITRAH",
                            data: phaseData.map((item) => ({
                                ...item,
                                value: item.caps,
                                label: {
                                    // position: "inside",
                                    formatter: `${item.ori}`,
                                },
                                itemStyle: {
                                    ...item.itemStyle,
                                    opacity: 0.5,
                                    color: "#fff",
                                },
                            })),
                            universalTransition: {
                                enabled: true,
                                // seriesKey: ["ruh", "jasad"],
                            },
                            itemStyle: { borderRadius: [5, 5, 0, 0] },
                            label: {
                                show: true,
                                position: "top",
                                fontSize: 10,
                            },
                            // Add MarkAreas for Backgrounds
                            markArea: {
                                silent: true, // Not clickable
                                itemStyle: { opacity: 0.15 },
                                label: {
                                    position: "top",
                                    color: "#333",
                                    fontSize: 14,
                                    fontWeight: "bold",
                                },
                                data: [
                                    [
                                        {
                                            name: "Fisik (PQ)\n(Karsa)",
                                            xAxis: 0,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: countKarsa - 1 },
                                    ],
                                    [
                                        {
                                            name: "Akal (IQ)\n(Cipta)",
                                            xAxis: countKarsa,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: countKarsa + countCipta - 1 },
                                    ],
                                    [
                                        {
                                            name: "Hati (EQ)\n(Rasa)",
                                            xAxis: countKarsa + countCipta,
                                            itemStyle: { color: "white" },
                                        },
                                        { xAxis: categories.length - 1 },
                                    ],
                                ],
                            },
                            // Add Aqidah Line covering all
                            markLine: {
                                symbol: ["none", "none"],
                                label: {
                                    show: true,
                                    position: "insideMiddleBottom",
                                    formatter: "{b}",
                                    backgroundColor: "#4ade80",
                                    color: "#fff",
                                    padding: [4, 8],
                                    margin: [0, -10],
                                    borderRadius: 4,
                                },
                                lineStyle: {
                                    color: "#22c55e",
                                    width: 4,
                                    type: "solid",
                                },
                                data: [
                                    { yAxis: 50, name: "Sholih" },
                                    { yAxis: 100, name: "Muslih" },
                                ],
                                animation: false,
                            },
                        },
                    ],
                    animationDurationUpdate: 1000,
                };
            }

            // ==========================================
            // 3. PAGE CONFIGURATION
            // ==========================================

            const pagesConfig = [
                { label: "1. Ruh dan Jasad", generator: getSplitViewOption },
                { label: "2. 3 Jiwa", generator: getJiwaViewOption },
                { label: "3. Kecerdasan", generator: getKecerdasanViewOption },
                {
                    label: "4. Tujuan Hidup",
                    generator: getTujuanHidupViewOption,
                },
                {
                    label: "5. Fitrah & Karakter",
                    generator: getFitrahKarakterViewOption,
                },
                {
                    label: "6. Thufulah",
                    generator: getThufulahViewOption,
                },
                {
                    label: "7. Tamyiz",
                    generator: getTamyizViewOption,
                },
                {
                    label: "8. Murahaqah",
                    generator: getMurahaqahViewOption,
                },
                {
                    label: "9. Syabab",
                    generator: getSyababViewOption,
                },
            ];

            // ADDING DUMMY PAGES
            // for (let i = 4; i <= 10; i++) {
            //     pagesConfig.push({
            //         label: `${i}. Dummy Page`,
            //         generator:
            //             i % 2 === 0
            //                 ? getJiwaViewOption
            //                 : getKecerdasanViewOption,
            //     });
            // }

            // ==========================================
            // 4. APP LOGIC
            // ==========================================

            const chartDom = document.getElementById("chart-container");
            const myChart = echarts.init(chartDom);
            let currentIndex = 0;

            function renderNavigation() {
                const navContainer = document.getElementById("nav-container");
                navContainer.innerHTML = "";

                const activeClass =
                    "bg-indigo-600 text-white shadow-md transform scale-105";
                const inactiveClass =
                    "bg-white text-gray-600 border border-gray-200 hover:bg-gray-50 hover:border-gray-300";
                const baseClass =
                    "btn-transition h-10 px-4 rounded-lg text-sm font-medium whitespace-nowrap flex items-center justify-center flex-shrink-0 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2";

                pagesConfig.forEach((page, index) => {
                    const btn = document.createElement("button");
                    btn.textContent = page.label;
                    btn.id = `nav-btn-${index}`;
                    const stateClass =
                        index === currentIndex ? activeClass : inactiveClass;
                    btn.className = `${baseClass} ${stateClass}`;
                    btn.onclick = () => switchPage(index);
                    navContainer.appendChild(btn);
                });
                updateControls();
                updateIndicator();
            }

            function updateControls() {
                document.getElementById("btn-prev").disabled =
                    currentIndex === 0;
                document.getElementById("btn-next").disabled =
                    currentIndex === pagesConfig.length - 1;
            }

            function updateIndicator() {
                document.getElementById("page-indicator").textContent =
                    `Page ${currentIndex + 1} of ${pagesConfig.length}`;
            }

            function switchPage(index) {
                if (index < 0 || index >= pagesConfig.length) return;
                currentIndex = index;
                const option = pagesConfig[index].generator();
                myChart.setOption(option, true); // true = merge:false to cleanly redraw
                renderNavigation();
                const activeBtn = document.getElementById(`nav-btn-${index}`);
                if (activeBtn)
                    activeBtn.scrollIntoView({
                        behavior: "smooth",
                        block: "nearest",
                        inline: "center",
                    });
            }

            function prevPage() {
                switchPage(currentIndex - 1);
            }
            function nextPage() {
                switchPage(currentIndex + 1);
            }

            // Init
            renderNavigation();
            switchPage(0);

            window.addEventListener("resize", () => {
                myChart.resize();
                myChart.setOption(pagesConfig[currentIndex].generator());
            });
        </script>
    </body>
</html>
