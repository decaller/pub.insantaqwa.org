<!doctype html>
<html lang="id" class="scroll-smooth">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Analisis Karakter - Article View</title>
        
        <!-- daisyUI + Tailwind CSS -->
        <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- ECharts & Icons -->
        <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
        <script src="https://unpkg.com/@phosphor-icons/web"></script>
        
        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">
        
        <style>
            body { 
                font-family: 'Plus Jakarta Sans', sans-serif; 
                background-color: #f8fafc; /* Light grey background for article feel */
            }
            
            h1, h2, h3 {
                font-family: 'Plus Jakarta Sans', sans-serif;
            }

            p {
                font-family: 'Merriweather', serif; /* Serif for article body text */
                line-height: 1.8;
                color: #334155;
            }

            /* --- LAYOUT TRANSITIONS --- */
            .chart-column, .text-column {
                transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            }

            /* --- MOBILE PORTRAIT (DEFAULT) --- */
            /* Chart is FIXED at the top */
            .chart-column {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 35vh; /* Default Mobile Height */
                z-index: 50;
                padding: 0.5rem;
                pointer-events: none; /* Let clicks pass through padding areas */
            }

            .chart-card-wrapper {
                pointer-events: auto; /* Re-enable clicks on the card itself */
                height: 100%;
                width: 100%;
            }

            /* Text pushes down to avoid being hidden behind chart */
            .text-column {
                width: 100%;
                padding: 1.5rem;
                padding-top: 38vh; /* 35vh chart + gap */
                min-height: 100vh;
            }

            /* --- DESKTOP & LANDSCAPE OVERRIDES --- */
            @media (min-width: 1024px), (orientation: landscape) and (min-width: 640px) {
                #main-layout {
                    flex-direction: row;
                }

                .chart-column {
                    position: sticky; /* Sticky on desktop side */
                    top: 0;
                    height: 100vh;
                    width: 50%; /* Desktop Default Width */
                    order: 2;
                    padding: 2rem;
                    background: transparent;
                }

                .text-column {
                    width: 50%; /* Desktop Default Width */
                    padding-top: 4rem;
                    padding-left: 4rem;
                    padding-right: 4rem;
                    order: 1;
                }
            }

            /* --- MAXIMIZED STATES (Toggled Class) --- */
            
            /* Mobile Portrait Maximized */
            body.chart-maximized .chart-column {
                height: 70vh; /* Expands down */
            }
            body.chart-maximized .text-column {
                padding-top: 73vh; /* Pushes text down further */
            }

            /* Desktop/Landscape Maximized */
            @media (min-width: 1024px), (orientation: landscape) and (min-width: 640px) {
                body.chart-maximized .chart-column {
                    width: 70%;
                    height: 100vh;
                }
                body.chart-maximized .text-column {
                    width: 30%;
                }
            }

            /* Article Section Styling */
            .article-section {
                margin-bottom: 6rem;
                scroll-margin-top: 40vh; /* Trigger point adjustment */
                opacity: 0.4;
                transition: opacity 0.5s ease;
            }
            
            .article-section.active {
                opacity: 1;
            }

            .no-scrollbar::-webkit-scrollbar { display: none; }
            .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        </style>
    </head>
    <body class="text-base-content" data-theme="winter">

        <div id="main-layout" class="flex flex-col min-h-screen relative">

            <!-- RIGHT COLUMN (CHART) - Order 1 visually on mobile via Fixed positioning -->
            <div class="chart-column">
                <div class="chart-card-wrapper">
                    <div class="card bg-base-100/80 backdrop-blur-md shadow-2xl h-full border border-white/50 w-full overflow-hidden">
                        <div class="card-body p-2 lg:p-6 relative h-full flex flex-col">
                            <!-- Header / Controls -->
                            <div class="flex justify-between items-center mb-2 z-10 w-full">
                                <div class="badge badge-primary badge-outline font-bold tracking-wider uppercase text-xs lg:text-sm p-3">
                                    Visualisasi Data
                                </div>
                                <button onclick="toggleMaximize()" class="btn btn-sm btn-circle btn-ghost bg-base-200/50 hover:bg-base-300 border border-base-300" aria-label="Toggle Maximize">
                                    <i id="maximize-icon" class="ph-bold ph-arrows-out-simple text-lg"></i>
                                </button>
                            </div>
                            
                            <!-- Chart Area -->
                            <div class="flex-1 w-full min-h-0 relative rounded-xl overflow-hidden bg-base-100/50">
                                <div id="chart-container" class="absolute inset-0 w-full h-full"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LEFT COLUMN (TEXT ARTICLE) -->
            <div class="text-column">
                <article class="prose prose-slate lg:prose-lg max-w-none">
                    
                    <!-- Intro Header -->
                    <div class="mb-16">
                        <span class="text-primary font-bold tracking-widest uppercase text-sm mb-2 block">Laporan Analisis Psikologi</span>
                        <h1 class="text-4xl lg:text-6xl font-extrabold text-slate-900 leading-tight mb-6">
                            Pemetaan Potensi <br/>
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary">Manusia & Jiwa</span>
                        </h1>
                        <p class="text-xl leading-relaxed text-slate-600 italic border-l-4 border-primary pl-4">
                            "Mengenali diri adalah awal dari semua kebijaksanaan. Laporan ini mengeksplorasi keseimbangan antara dimensi spiritual dan fisik Anda."
                        </p>
                    </div>

                    <!-- Dynamic Sections Container -->
                    <div id="article-content">
                        <!-- JS will inject sections here -->
                    </div>

                    <!-- Footer -->
                    <div class="mt-24 pt-12 border-t border-slate-200 text-center text-slate-500 text-sm">
                        <p>Akhir dari laporan analisis.</p>
                        <button onclick="window.scrollTo({top:0, behavior:'smooth'})" class="btn btn-outline btn-sm gap-2 mt-4">
                            Kembali ke Atas <i class="ph-bold ph-arrow-up"></i>
                        </button>
                    </div>

                </article>
            </div>

        </div>

        <script>
            // ==========================================
            // 1. DATA & CONFIGURATION
            // ==========================================
            
            const palettes = {
                blue: ["#E3F2FD", "#BBDEFB", "#90CAF9", "#64B5F6", "#42A5F5", "#2196F3", "#1E88E5", "#1976D2", "#1565C0", "#0D47A1"],
                brown: ["#EFEBE9", "#D7CCC8", "#BCAAA4", "#A1887F", "#8D6E63", "#795548", "#6D4C41", "#5D4037", "#4E342E", "#3E2723"],
                red: ["#ffcdd2", "#ef9a9a", "#e57373", "#ef5350", "#f44336", "#e53935", "#d32f2f"], 
                yellow: ["#fff9c4", "#fff59d", "#fff176", "#ffee58", "#ffeb3b", "#fdd835", "#fbc02d"], 
                green: ["#c8e6c9", "#a5d6a7", "#81c784", "#66bb6a", "#4caf50", "#43a047", "#388e3c"]  
            };

            function getColor(type, index) {
                const palette = palettes[type] || palettes.blue;
                return palette[index % palette.length];
            }

            const rawDataGroups = [
                // RUH Data
                [
                    { name: "Himmah", score: 40, groupId: "Berambisi_Bekerja keras_Karsa_Introvert_ruh" },
                    { name: "Ihsaan", score: 30, groupId: "Berambisi_Bekerja keras_Karsa_Introvert_ruh" },
                    { name: "‘izzah", score: 40, groupId: "Berwibawa_Bekerja keras_Karsa_Introvert_ruh" },
                    { name: "Waqaar", score: 50, groupId: "Berwibawa_Bekerja keras_Karsa_Introvert_ruh" },
                    { name: "‘aziimah", score: 45, groupId: "Giat bekerja_Bekerja keras_Karsa_Introvert_ruh" },
                    { name: "Nasyaath", score: 50, groupId: "Giat bekerja_Bekerja keras_Karsa_Introvert_ruh" },
                    { name: "Firaasah", score: 40, groupId: "Suka berpikir imajinatif_Berpikir_Cipta_Introvert_ruh" },
                    { name: "Nubl", score: 30, groupId: "Suka berpikir imajinatif_Berpikir_Cipta_Introvert_ruh" },
                    { name: "Husnuzhan", score: 45, groupId: "Suka berpikir positif_Berpikir_Cipta_Introvert_ruh" },
                    { name: "Dzakaa’", score: 30, groupId: "Suka berpikir analitis_Berpikir_Cipta_Introvert_ruh" },
                    { name: "Hikmah", score: 30, groupId: "Suka berpikir analitis_Berpikir_Cipta_Introvert_ruh" },
                    { name: "Shidq", score: 45, groupId: "Suka apa adanya_Berperasaan_Rasa_Introvert_ruh" },
                    { name: "‘iffah", score: 50, groupId: "Pendiam_Berperasaan_Rasa_Introvert_ruh" },
                    { name: "Shamt", score: 40, groupId: "Pendiam_Berperasaan_Rasa_Introvert_ruh" },
                    { name: "Hayaa’", score: 50, groupId: "Suka merendah_Berperasaan_Rasa_Introvert_ruh" },
                    { name: "Qanaa'ah", score: 40, groupId: "Suka merendah_Berperasaan_Rasa_Introvert_ruh" },
                    { name: "Shabr", score: 35, groupId: "Suka merendah_Berperasaan_Rasa_Introvert_ruh" },
                    { name: "Syajaa’ah", score: 50, groupId: "Suka menguasai_Mempengaruhi_Karsa_Extrovert_ruh" },
                    { name: "Ghairah", score: 45, groupId: "Suka menguasai_Mempengaruhi_Karsa_Extrovert_ruh" },
                    { name: "Munaafasah", score: 35, groupId: "Suka menguasai_Mempengaruhi_Karsa_Extrovert_ruh" },
                    { name: "Nashiihah", score: 45, groupId: "Suka memotivasi_Mempengaruhi_Karsa_Extrovert_ruh" },
                    { name: "Fashaahah", score: 35, groupId: "Suka memotivasi_Mempengaruhi_Karsa_Extrovert_ruh" },
                    { name: "Nushrah", score: 35, groupId: "Suka menolong_Mempengaruhi_Karsa_Extrovert_ruh" },
                    { name: "Juud", score: 45, groupId: "Suka menolong_Mempengaruhi_Karsa_Extrovert_ruh" },
                    { name: "Ta'aawun", score: 30, groupId: "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_ruh" },
                    { name: "Ulfah", score: 40, groupId: "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_ruh" },
                    { name: "‘adaalah", score: 30, groupId: "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_ruh" },
                    { name: "Wafaa'", score: 45, groupId: "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_ruh" },
                    { name: "Muzaah", score: 40, groupId: "Suka membuat hubungan baru_Bekerjasama_Cipta_Extrovert_ruh" },
                    { name: "Basyaasyah", score: 50, groupId: "Suka membuat hubungan baru_Bekerjasama_Cipta_Extrovert_ruh" },
                    { name: "Rifq", score: 50, groupId: "Suka mengeratkan hubungan yang sudah ada_Bekerjasama_Cipta_Extrovert_ruh" },
                    { name: "Rahmah", score: 45, groupId: "Suka mengeratkan hubungan yang sudah ada_Bekerjasama_Cipta_Extrovert_ruh" },
                    { name: "Mahabbah", score: 30, groupId: "Suka melayani dengan cara memberi_Melayani_Rasa_Extrovert_ruh" },
                    { name: "Itsaar", score: 35, groupId: "Suka melayani dengan cara memberi_Melayani_Rasa_Extrovert_ruh" },
                    { name: "Kitmaanus sirr", score: 50, groupId: "Suka melayani dengan cara menjaga_Melayani_Rasa_Extrovert_ruh" },
                    { name: "Satr", score: 30, groupId: "Suka melayani dengan cara menjaga_Melayani_Rasa_Extrovert_ruh" },
                    { name: "Amaanah", score: 35, groupId: "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_ruh" },
                    { name: "Anaah", score: 40, groupId: "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_ruh" },
                    { name: "Hilm", score: 35, groupId: "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_ruh" },
                    { name: "Tawaadhu'", score: 35, groupId: "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_ruh" },
                ],
                // JASAD Data
                [
                    { name: "Himmah", score: 40, groupId: "Berambisi_Bekerja keras_Karsa_Introvert_jasad" },
                    { name: "Ihsaan", score: 30, groupId: "Berambisi_Bekerja keras_Karsa_Introvert_jasad" },
                    { name: "‘izzah", score: 40, groupId: "Berwibawa_Bekerja keras_Karsa_Introvert_jasad" },
                    { name: "Waqaar", score: 50, groupId: "Berwibawa_Bekerja keras_Karsa_Introvert_jasad" },
                    { name: "‘aziimah", score: 45, groupId: "Giat bekerja_Bekerja keras_Karsa_Introvert_jasad" },
                    { name: "Nasyaath", score: 50, groupId: "Giat bekerja_Bekerja keras_Karsa_Introvert_jasad" },
                    { name: "Firaasah", score: 40, groupId: "Suka berpikir imajinatif_Berpikir_Cipta_Introvert_jasad" },
                    { name: "Nubl", score: 30, groupId: "Suka berpikir imajinatif_Berpikir_Cipta_Introvert_jasad" },
                    { name: "Husnuzhan", score: 45, groupId: "Suka berpikir positif_Berpikir_Cipta_Introvert_jasad" },
                    { name: "Dzakaa’", score: 30, groupId: "Suka berpikir analitis_Berpikir_Cipta_Introvert_jasad" },
                    { name: "Hikmah", score: 30, groupId: "Suka berpikir analitis_Berpikir_Cipta_Introvert_jasad" },
                    { name: "Shidq", score: 45, groupId: "Suka apa adanya_Berperasaan_Rasa_Introvert_jasad" },
                    { name: "‘iffah", score: 50, groupId: "Pendiam_Berperasaan_Rasa_Introvert_jasad" },
                    { name: "Shamt", score: 40, groupId: "Pendiam_Berperasaan_Rasa_Introvert_jasad" },
                    { name: "Hayaa’", score: 50, groupId: "Suka merendah_Berperasaan_Rasa_Introvert_jasad" },
                    { name: "Qanaa'ah", score: 40, groupId: "Suka merendah_Berperasaan_Rasa_Introvert_jasad" },
                    { name: "Shabr", score: 35, groupId: "Suka merendah_Berperasaan_Rasa_Introvert_jasad" },
                    { name: "Syajaa’ah", score: 50, groupId: "Suka menguasai_Mempengaruhi_Karsa_Extrovert_jasad" },
                    { name: "Ghairah", score: 45, groupId: "Suka menguasai_Mempengaruhi_Karsa_Extrovert_jasad" },
                    { name: "Munaafasah", score: 35, groupId: "Suka menguasai_Mempengaruhi_Karsa_Extrovert_jasad" },
                    { name: "Nashiihah", score: 45, groupId: "Suka memotivasi_Mempengaruhi_Karsa_Extrovert_jasad" },
                    { name: "Fashaahah", score: 35, groupId: "Suka memotivasi_Mempengaruhi_Karsa_Extrovert_jasad" },
                    { name: "Nushrah", score: 35, groupId: "Suka menolong_Mempengaruhi_Karsa_Extrovert_jasad" },
                    { name: "Juud", score: 45, groupId: "Suka menolong_Mempengaruhi_Karsa_Extrovert_jasad" },
                    { name: "Ta'aawun", score: 30, groupId: "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_jasad" },
                    { name: "Ulfah", score: 40, groupId: "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_jasad" },
                    { name: "‘adaalah", score: 30, groupId: "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_jasad" },
                    { name: "Wafaa'", score: 45, groupId: "Suka menggunakan hubungan yang ada_Bekerjasama_Cipta_Extrovert_jasad" },
                    { name: "Muzaah", score: 40, groupId: "Suka membuat hubungan baru_Bekerjasama_Cipta_Extrovert_jasad" },
                    { name: "Basyaasyah", score: 50, groupId: "Suka membuat hubungan baru_Bekerjasama_Cipta_Extrovert_jasad" },
                    { name: "Rifq", score: 50, groupId: "Suka mengeratkan hubungan yang sudah ada_Bekerjasama_Cipta_Extrovert_jasad" },
                    { name: "Rahmah", score: 45, groupId: "Suka mengeratkan hubungan yang sudah ada_Bekerjasama_Cipta_Extrovert_jasad" },
                    { name: "Mahabbah", score: 30, groupId: "Suka melayani dengan cara memberi_Melayani_Rasa_Extrovert_jasad" },
                    { name: "Itsaar", score: 35, groupId: "Suka melayani dengan cara memberi_Melayani_Rasa_Extrovert_jasad" },
                    { name: "Kitmaanus sirr", score: 50, groupId: "Suka melayani dengan cara menjaga_Melayani_Rasa_Extrovert_jasad" },
                    { name: "Satr", score: 30, groupId: "Suka melayani dengan cara menjaga_Melayani_Rasa_Extrovert_jasad" },
                    { name: "Amaanah", score: 35, groupId: "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_jasad" },
                    { name: "Anaah", score: 40, groupId: "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_jasad" },
                    { name: "Hilm", score: 35, groupId: "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_jasad" },
                    { name: "Tawaadhu'", score: 35, groupId: "Suka melayani dengan cara mengalah_Melayani_Rasa_Extrovert_jasad" },
                ],
            ];

            // 1. Basic Lists
            const ruhList = rawDataGroups[0].map((item, index) => ({
                name: item.name,
                value: item.score,
                itemStyle: { color: getColor("blue", index) },
            }));

            const jasadList = rawDataGroups[1].map((item, index) => ({
                name: item.name,
                value: item.score,
                itemStyle: { color: getColor("brown", index) },
            }));

            // 2. Combined List with Sorting
            const combinedList = rawDataGroups[0]
                .map((item, index) => {
                    const jasadItem = rawDataGroups[1].find(j => j.name === item.name) || { score: 0 };
                    const mergedValue = item.score + jasadItem.score;
                    const groupString = item.groupId;
                    let itemColor = "#ccc";
                    let sortIndex = 99;

                    if (groupString.includes("Karsa")) {
                        itemColor = getColor("red", index);
                        sortIndex = 1;
                    } else if (groupString.includes("Cipta")) {
                        itemColor = getColor("yellow", index);
                        sortIndex = 2;
                    } else if (groupString.includes("Rasa")) {
                        itemColor = getColor("green", index);
                        sortIndex = 3;
                    }

                    return {
                        name: item.name,
                        value: mergedValue,
                        itemStyle: { color: itemColor },
                        sortIndex: sortIndex,
                    };
                })
                .sort((a, b) => a.sortIndex - b.sortIndex);

            // 3. Aggregate Data
            let ammarahSum = 0;
            let lawwamahSum = 0;
            let muthmainnahSum = 0;
            let countKarsa = 0;
            let countCipta = 0;
            let countRasa = 0;

            combinedList.forEach(item => {
                if(item.sortIndex === 1) { ammarahSum += item.value; countKarsa++; }
                if(item.sortIndex === 2) { lawwamahSum += item.value; countCipta++; }
                if(item.sortIndex === 3) { muthmainnahSum += item.value; countRasa++; }
            });

            const jiwaOuterData = [
                { value: ammarahSum, name: 'Jiwa Ammarah\n(Karsa)', itemStyle: { color: '#ef5350' } },
                { value: lawwamahSum, name: 'Jiwa Lawwamah\n(Cipta)', itemStyle: { color: '#fdd835' } },
                { value: muthmainnahSum, name: 'Jiwa Muthmainnah\n(Rasa)', itemStyle: { color: '#66bb6a' } }
            ];

            // ==========================================
            // 2. CHART GENERATOR FUNCTIONS
            // ==========================================
            const isMobile = () => {
                const isLandscape = window.matchMedia("(orientation: landscape)").matches;
                const width = window.innerWidth;
                if (width >= 1024) return false;
                if (isLandscape && width >= 640) return false;
                return true;
            };

            const baseSeriesConfig = {
                type: "pie",
                emphasis: { itemStyle: { shadowBlur: 10, shadowOffsetX: 0, shadowColor: "rgba(0, 0, 0, 0.5)" } },
                label: { show: true, position: "outside", formatter: "{b}", fontSize: 10 },
                labelLine: { show: true, length: 15 },
            };

            function getSplitViewOption() {
                const mobile = isMobile();
                // If maximized on mobile, reduce label usage or text size
                const isMax = document.body.classList.contains('chart-maximized');
                return {
                    title: [
                        { text: "Dimensi Ruh", left: mobile ? "50%" : "25%", top: mobile ? "5%" : "15%", textAlign: "center", textStyle: { fontSize: mobile ? 14 : 16 } },
                        { text: "Dimensi Jasad", left: mobile ? "50%" : "75%", top: mobile ? "50%" : "15%", textAlign: "center", textStyle: { fontSize: mobile ? 14 : 16 } },
                    ],
                    tooltip: { trigger: "item", formatter: "{b}: {c}" },
                    grid: { show: false }, 
                    series: [
                        {
                            ...baseSeriesConfig,
                            id: "ruh", name: "Ruh",
                            radius: isMax ? ["25%", "45%"] : ["35%", "55%"],
                            center: mobile ? ["50%", "28%"] : ["25%", "55%"],
                            data: ruhList,
                            universalTransition: { enabled: true },
                        },
                        {
                            ...baseSeriesConfig,
                            id: "jasad", name: "Jasad",
                            radius: isMax ? ["25%", "45%"] : ["35%", "55%"],
                            center: mobile ? ["50%", "72%"] : ["75%", "55%"], 
                            data: jasadList,
                            universalTransition: { enabled: true },
                        },
                    ],
                    animationDurationUpdate: 800,
                };
            }

            function getJiwaViewOption() {
                const mobile = isMobile();
                const isMax = document.body.classList.contains('chart-maximized');
                return {
                    title: { text: "3 Jiwa (Nested Pie)", left: "center", top: mobile ? "2%" : "5%", textStyle: { fontSize: mobile? 16:20, fontWeight: 'bold' } },
                    tooltip: { trigger: "item", formatter: "{b}: {c}" },
                    series: [
                        {
                            ...baseSeriesConfig,
                            id: "combined",
                            name: "Detail",
                            radius: ["0%", mobile ? "25%" : "40%"],
                            center: ["50%", "55%"],
                            data: combinedList,
                            label: { show: !mobile || isMax, position: 'inner', fontSize: 9, formatter: "{b}" },
                            labelLine: { show: false },
                            universalTransition: { enabled: true, seriesKey: ["ruh", "jasad"] },
                        },
                        {
                            type: 'pie',
                            name: 'Jiwa Group',
                            radius: [mobile ? "30%" : "45%", mobile ? "55%" : "70%"],
                            center: ["50%", "55%"],
                            data: jiwaOuterData,
                            label: { 
                                show: true, 
                                position: 'outside', 
                                formatter: '{b}\n{d}%', 
                                fontWeight: 'bold',
                                fontSize: mobile && !isMax ? 10 : 12
                            },
                            itemStyle: {
                                borderRadius: 4,
                                borderColor: '#fff',
                                borderWidth: 2
                            }
                        }
                    ],
                    animationDurationUpdate: 800,
                };
            }

            function getKecerdasanViewOption() {
                const categories = combinedList.map((i) => i.name);
                const mobile = isMobile();
                const isMax = document.body.classList.contains('chart-maximized');
                
                return {
                    title: { text: "Kecerdasan & Aqidah", left: "center", top: "5%", textStyle: { fontSize: mobile? 16:18 } },
                    tooltip: { trigger: "item", formatter: "{b}: {c}" },
                    grid: { left: "5%", right: "5%", bottom: mobile && !isMax ? "5%" : "15%", top: "15%", containLabel: true },
                    xAxis: {
                        type: "category",
                        data: categories,
                        axisLabel: { interval: 0, rotate: 45, fontSize: 10 },
                        z: 10
                    },
                    yAxis: { type: "value" },
                    series: [
                        {
                            type: "bar",
                            id: "combined",
                            name: "Nilai",
                            data: combinedList,
                            universalTransition: { enabled: true, seriesKey: ["ruh", "jasad"] },
                            itemStyle: { borderRadius: [5, 5, 0, 0] },
                            label: { show: true, position: "top", fontSize: 10 },
                            markArea: {
                                silent: true,
                                itemStyle: { opacity: 0.1 },
                                label: { position: 'top', color: '#333', fontSize: mobile ? 10 : 14, fontWeight: 'bold' },
                                data: [
                                    [{ name: 'Fisik', xAxis: 0, itemStyle: { color: 'red' } }, { xAxis: countKarsa - 1 }],
                                    [{ name: 'Akal', xAxis: countKarsa, itemStyle: { color: 'yellow' } }, { xAxis: countKarsa + countCipta - 1 }],
                                    [{ name: 'Hati', xAxis: countKarsa + countCipta, itemStyle: { color: 'green' } }, { xAxis: categories.length - 1 }]
                                ]
                            },
                            markLine: {
                                symbol: ['none', 'none'],
                                label: { show: true, position: 'start', formatter: 'Aqidah (SQ)', backgroundColor: '#4ade80', color: '#fff', padding: [4, 8], borderRadius: 4 },
                                lineStyle: { color: '#22c55e', width: 4, type: 'solid' },
                                data: [{ yAxis: 20 }]
                            }
                        },
                    ],
                    animationDurationUpdate: 800,
                };
            }

            // ==========================================
            // 3. STORY CONTENT (ARTICLE TEXT)
            // ==========================================
            
            const storyContent = [
                {
                    title: "Dualitas Manusia: Ruh & Jasad",
                    desc: "<p>Manusia adalah makhluk yang unik, terbentuk dari paduan harmonis antara dua elemen fundamental: <strong>Ruh</strong> yang bersifat spiritual dan abadi, serta <strong>Jasad</strong> yang bersifat fisik dan sementara.</p><br/><p>Dalam diagram di atas (atau di samping), kita memvisualisasikan data Anda yang terbagi ke dalam dua hemisfer ini. Warna biru merepresentasikan dimensi Ruhani, sementara warna coklat mewakili aspek Jasmani. Keseimbangan antara keduanya sangat penting untuk stabilitas psikologis.</p>",
                    generator: getSplitViewOption
                },
                {
                    title: "Dinamika Tiga Jiwa",
                    desc: "<p>Ketika Ruh ditiupkan ke dalam Jasad, lahirlah <strong>Jiwa</strong>. Jiwa ini tidak tunggal, melainkan memiliki tiga kecenderungan utama yang saling tarik-menarik:</p><br/><ul><li><strong class='text-red-500'>Jiwa Ammarah (Karsa)</strong>: Energi pendorong, ambisi, dan keinginan dasar.</li><li><strong class='text-yellow-500'>Jiwa Lawwamah (Cipta)</strong>: Kesadaran diri, logika, dan kemampuan analitis.</li><li><strong class='text-green-500'>Jiwa Muthmainnah (Rasa)</strong>: Ketenangan, spiritualitas, dan kedamaian batin.</li></ul><p class='mt-4'>Grafik lingkaran bertingkat (nested pie) menunjukkan proporsi ketiga jiwa ini dalam diri Anda.</p>",
                    generator: getJiwaViewOption
                },
                {
                    title: "Peta Kecerdasan & Aqidah",
                    desc: "<p>Dari struktur jiwa tersebut, kita dapat menurunkan peta kecerdasan holistik:</p><br/><ol><li><strong>PQ (Physical Quotient)</strong>: Berkaitan dengan Ammarah/Fisik.</li><li><strong>IQ (Intellectual Quotient)</strong>: Berkaitan dengan Lawwamah/Akal.</li><li><strong>EQ (Emotional Quotient)</strong>: Berkaitan dengan Muthmainnah/Hati.</li></ol><p class='mt-4'>Namun, semua potensi ini harus dinaungi oleh <strong>SQ (Spiritual Quotient)</strong> atau Aqidah, yang digambarkan sebagai garis batas minimal. Jika batang nilai Anda berada di bawah garis Aqidah, ini menandakan area yang perlu penguatan spiritual.</p>",
                    generator: getKecerdasanViewOption
                },
                {
                    title: "Refleksi Dominasi Jiwa",
                    desc: "<p>Mari kita kembali melihat komposisi Jiwa Anda secara mendalam. Perhatikan warna dominan pada grafik.</p><br/><p>Jika sektor Merah paling besar, Anda adalah tipe 'Doer' atau penggerak yang energik. Jika Kuning mendominasi, Anda adalah 'Thinker' yang kritis. Jika Hijau yang paling luas, Anda adalah 'Feeler' yang empatik dan tenang. Mengetahui dominasi ini membantu Anda memilih lingkungan kerja yang paling sesuai.</p>",
                    generator: getJiwaViewOption
                },
                {
                    title: "Menemukan Kekuatan Utama",
                    desc: "<p>Dalam grafik batang terakhir ini, fokuslah pada puncak tertinggi. Batang tertinggi mewakili atribut karakter terkuat Anda.</p><br/><p>Apakah itu ketekunan (Himmah)? Kecerdasan (Fathonah)? Atau kejujuran (Shidq)? Mengembangkan kekuatan alami ini jauh lebih efektif daripada hanya fokus memperbaiki kelemahan. Jadikan ini sebagai modal utama dalam pengembangan karir dan kehidupan sosial Anda.</p>",
                    generator: getKecerdasanViewOption
                }
            ];

            // ==========================================
            // 4. APP LOGIC
            // ==========================================

            const chartDom = document.getElementById("chart-container");
            const myChart = echarts.init(chartDom);
            const contentContainer = document.getElementById("article-content");

            // 1. Generate Article Sections
            storyContent.forEach((story, index) => {
                const section = document.createElement("section");
                section.className = "article-section";
                section.dataset.index = index;
                
                section.innerHTML = `
                    <div class="mb-4">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Bagian ${index + 1}</span>
                        <h2 class="text-2xl lg:text-3xl font-bold text-slate-800 mt-1 mb-4">${story.title}</h2>
                        <div class="prose prose-p:text-slate-600 prose-li:text-slate-600 text-lg">
                            ${story.desc}
                        </div>
                    </div>
                `;
                contentContainer.appendChild(section);
            });

            // 2. Initial Chart
            let currentOption = storyContent[0].generator();
            myChart.setOption(currentOption);

            // 3. Intersection Observer for Scroll Trigger
            const observerOptions = {
                root: null,
                rootMargin: "-40% 0px -40% 0px", // Trigger when element is in middle viewport
                threshold: 0.1
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const index = parseInt(entry.target.dataset.index);
                        
                        // Style active section
                        document.querySelectorAll('.article-section').forEach(s => s.classList.remove('active'));
                        entry.target.classList.add('active');

                        // Update Chart
                        const generator = storyContent[index].generator;
                        if (generator) {
                            myChart.setOption(generator(), true);
                        }
                    }
                });
            }, observerOptions);

            document.querySelectorAll('.article-section').forEach(section => {
                observer.observe(section);
            });

            // 4. Maximize/Minimize Logic
            function toggleMaximize() {
                document.body.classList.toggle('chart-maximized');
                
                const icon = document.getElementById('maximize-icon');
                if (document.body.classList.contains('chart-maximized')) {
                    icon.classList.replace('ph-arrows-out-simple', 'ph-arrows-in-simple');
                } else {
                    icon.classList.replace('ph-arrows-in-simple', 'ph-arrows-out-simple');
                }

                // Wait for transition then resize chart
                setTimeout(() => {
                    myChart.resize();
                    // Force refresh chart config to adapt to new size (mobile radius adjustments etc)
                    const activeSection = document.querySelector('.article-section.active');
                    if(activeSection) {
                        const index = activeSection.dataset.index;
                        myChart.setOption(storyContent[index].generator());
                    }
                }, 550);
            }

            // 5. Robust Resizing
            const resizeObserver = new ResizeObserver(() => {
                myChart.resize();
                const activeSection = document.querySelector('.article-section.active');
                if(activeSection) {
                    const index = activeSection.dataset.index;
                    myChart.setOption(storyContent[index].generator());
                } else {
                    myChart.setOption(storyContent[0].generator());
                }
            });
            resizeObserver.observe(document.querySelector('.chart-column'));

            // Initial active state
            document.querySelector('.article-section').classList.add('active');

        </script>
    </body>
</html>